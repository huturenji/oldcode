!function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("Vue")):"function"===typeof define&&define.amd?define("swpServiceAuth",["Vue"],t):"object"===typeof exports?exports.swpServiceAuth=t(require("Vue")):e.swpServiceAuth=t(e.Vue)}("undefined"!==typeof self?self:this,function(e){return function(e){var t=window.webpackJsonpswpServiceAuth;window.webpackJsonpswpServiceAuth=function(n,o,a){for(var i,c,u=0,s=[];u<n.length;u++)c=n[u],r[c]&&s.push(r[c][0]),r[c]=0;for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i]);for(t&&t(n,o,a);s.length;)s.shift()()};var n={},r={2:0};function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.e=function(e){var t=r[e];if(0===t)return new Promise(function(e){e()});if(t)return t[2];var n=new Promise(function(n,o){t=r[e]=[n,o]});t[2]=n;var a=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.charset="utf-8",i.async=!0,i.timeout=12e4,o.nc&&i.setAttribute("nonce",o.nc),i.src=o.p+""+e+".swp-serviceAuth.js";var c=setTimeout(u,12e4);function u(){i.onerror=i.onload=null,clearTimeout(c);var t=r[e];0!==t&&(t&&t[1](new Error("Loading chunk "+e+" failed.")),r[e]=void 0)}return i.onerror=i.onload=u,a.appendChild(i),n},o.m=e,o.c=n,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e},o(o.s="lVK7")}({"+E39":function(e,t,n){e.exports=!n("S82l")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},"+ZMJ":function(e,t,n){var r=n("lOnJ");e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},"+tPU":function(e,t,n){n("xGkn");for(var r=n("7KvD"),o=n("hJx8"),a=n("/bQp"),i=n("dSzd")("toStringTag"),c="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<c.length;u++){var s=c[u],f=r[s],l=f&&f.prototype;l&&!l[i]&&o(l,i,s),a[s]=a.Array}},"//Fk":function(e,t,n){e.exports={default:n("U5ju"),__esModule:!0}},"/bQp":function(e,t){e.exports={}},"/n6Q":function(e,t,n){n("zQR9"),n("+tPU"),e.exports=n("Kh4W").f("iterator")},"06OY":function(e,t,n){var r=n("3Eo+")("meta"),o=n("EqjI"),a=n("D2L2"),i=n("evD5").f,c=0,u=Object.isExtensible||function(){return!0},s=!n("S82l")(function(){return u(Object.preventExtensions({}))}),f=function(e){i(e,r,{value:{i:"O"+ ++c,w:{}}})},l=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,r)){if(!u(e))return"F";if(!t)return"E";f(e)}return e[r].i},getWeak:function(e,t){if(!a(e,r)){if(!u(e))return!0;if(!t)return!1;f(e)}return e[r].w},onFreeze:function(e){return s&&l.NEED&&u(e)&&!a(e,r)&&f(e),e}}},"0xDb":function(e,t,n){"use strict";var r={};n.d(r,"request",function(){return h});var o=n("woOf"),a=n.n(o),i=n("Y+Xn"),c=n("FVbR"),u=n("mvHQ"),s=n.n(u),f=n("//Fk"),l=n.n(f);function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];return n=a()({},n),e.startsWith("http://")||e.startsWith("https://")||(e=location.origin+e),"GET"===(n.method||"").toUpperCase()&&a()(t,{t:(new Date).getTime()}),new l.a(function(r,o){(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new l.a(function(r,o){i.a.CheckNetWorkFunction().then(function(a){if(a){var c={url:e,data:t,method:n.method||"post",timeout:n.timeout,headers:n.headers,responseType:n.responseType||"json"};i.a.httpRequest(c).then(function(t){i.a.errorCodeInterceptor.init({url:e,code:t.resultCode,data:t}).run().then(function(){r(t)}).catch(function(){o(t)})}).catch(function(t){i.a.errorCodeInterceptor.init().run("NETWORK_ERR",e).then(function(){r()}).catch(function(e){console.error(e)}),o(t),console.error(t)})}else console.log("net is disable"),o("net is disable")})})})(e,t,n).then(function(e){0==e.resultCode?r(e):o(e)}).catch(function(e){o(e.resultCode?e:null);try{log.err(e&&s()(e))}catch(e){}})})}var p=n("oAV5"),d={};d=a()({},d,i.a),d=a()({},d,c.a),d=a()({},d,r),d=a()({},d,p.a);t.a=d},"1kS7":function(e,t){t.f=Object.getOwnPropertySymbols},"2KxR":function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},"3Eo+":function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},"3fs2":function(e,t,n){var r=n("RY/4"),o=n("dSzd")("iterator"),a=n("/bQp");e.exports=n("FeBl").getIteratorMethod=function(e){if(void 0!=e)return e[o]||e["@@iterator"]||a[r(e)]}},"4mcu":function(e,t){e.exports=function(){}},"52gC":function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},"5QVw":function(e,t,n){e.exports={default:n("BwfY"),__esModule:!0}},"77Pl":function(e,t,n){var r=n("EqjI");e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},"7KvD":function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},"7UMu":function(e,t,n){var r=n("R9M2");e.exports=Array.isArray||function(e){return"Array"==r(e)}},"825g":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("Xxa5"),o=n.n(r),a=n("woOf"),i=n.n(a),c=n("//Fk"),u=n.n(c),s=n("exGp"),f=n.n(s),l=n("lRwf"),h=n.n(l),p=(n("TQ8S"),n("0xDb")),d=n("Zrlr"),v=n.n(d),g=n("wxAW"),y=n.n(g),m=n("HR9g"),k=n("DuQW"),x=x||window.Promise,b=function(){function e(t){v()(this,e),this.config=t,this.loginKcConfig={},Object(k.a)()}return y()(e,[{key:"init",value:function(){var e=f()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTchatUserInfo();case 2:return this.tchatUserInfo=e.sent,e.next=5,this.getChannelId();case 5:return this.channelId=e.sent,e.next=8,this.setKeycloakParams();case 8:return this.primaryKey=this.getPrimaryKey(),e.next=11,this.defineProperties();case 11:return this.logined=this.isTokenAvaliable(),this.logined&&(this.token=this.getCacheToken()),e.abrupt("return");case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getProtocolKey",value:function(){return"function"==typeof this.config.protocolKey?this.config.protocolKey({userId:this.tchatUserInfo.uaId,cpyId:this.tchatUserInfo.cpyId,channelId:this.channelId}):this.config.protocolKey||this.tchatUserInfo.uaId+"_"+this.tchatUserInfo.cpyId+"_"+this.channelId+"_"+this.loginKcConfig.clientId}},{key:"getPrimaryKey",value:function(){return"function"==typeof this.config.primaryKey?this.config.primaryKey({userId:this.tchatUserInfo.uaId,cpyId:this.tchatUserInfo.cpyId,channelId:this.channelId}):this.config.primaryKey||this.tchatUserInfo.uaId+"_"+this.tchatUserInfo.cpyId+"_"+this.channelId+"_"+this.loginKcConfig.clientId}},{key:"getChannelId",value:function(){var e=f()(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.channelId){e.next=3;break}return e.abrupt("return",this.channelId);case 3:if(!this.config.channelId){e.next=5;break}return e.abrupt("return",this.config.channelId);case 5:return e.next=7,p.a.getAppConfigFunction({key:"tid"});case 7:return t=e.sent,e.abrupt("return",t&&t.value);case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}},e,this,[[0,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"getTchatUserInfo",value:function(){return new x(function(e){p.a.getUserInfoFunction().then(function(t){var n=p.a.getNonnullValue(t.cpyId);n||p.a.showToast("用户信息缺失：cpyId为空"),e({uaId:p.a.getNonnullValue(t.UAId),cpyId:n,cpyName:p.a.getNonnullValue(t.cpyName),userName:p.a.getNonnullValue(t.uName),userPhone:p.a.getNonnullValue(t.uPhone)})}).catch(function(t){console.error(t),e()})})}},{key:"isTokenAvaliable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:90;try{var t=this.getCacheToken();return!(!(t=t?p.a.decodeToken(t):null)||p.a.isTokenExpired(t,e))}catch(e){return console.error(e),!1}}},{key:"setKeycloakParams",value:function(){var e=f()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLoginConfig(this.config.loginKcConfig);case 2:this.loginKcConfig=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"defineProperties",value:function(){var e=f()(o.a.mark(function e(){var t,n,r=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this,n=this.getProtocolKey(),this.setUserConsent=function(e){var t=n?n+m.a.SPLIT+r.config.cacheKey.USER_CONSENT:null;t&&e&&p.a.setStorage(t,e)},this.getUserConsent=f()(o.a.mark(function e(){var a,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n?n+m.a.SPLIT+r.config.cacheKey.USER_CONSENT:null,e.prev=1,null==t._getUserConsent||void 0==t._getUserConsent){e.next=4;break}return e.abrupt("return",t._getUserConsent);case 4:if(i=!!a&&"true"==p.a.getStorage(a)){e.next=9;break}return e.next=8,t.getUserConsentFunc();case 8:i=e.sent;case 9:return i&&a&&p.a.setStorage(a,!0),t._getUserConsent=i,e.abrupt("return",!!i);case 14:return e.prev=14,e.t0=e.catch(1),e.abrupt("return",!1);case 17:case"end":return e.stop()}},e,r,[[1,14]])}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"enableAuthorize",value:function(){return this.config.enableAuthorize}},{key:"getAuthContent",value:function(){var e=this;return new x(function(){var t=f()(o.a.mark(function t(n){var r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.config.getAppProtocolsFunc||"function"!=typeof e.config.getAppProtocolsFunc){t.next=8;break}return t.next=4,e.config.getAppProtocolsFunc(e.token);case 4:r=t.sent,n(r),t.next=9;break;case 8:n();case 9:t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),console.error(t.t0),n();case 15:case"end":return t.stop()}},t,e,[[0,11]])}));return function(e){return t.apply(this,arguments)}}())}},{key:"consentAgreement",value:function(e){var t=this,n=this;return new x(function(){var r=f()(o.a.mark(function r(a){var i,c,u,s;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=t.config.logUserConsentFunc&&"function"==typeof t.config.logUserConsentFunc,r.prev=1,!i){r.next=12;break}return c=n.token,u={protocols:e,token:c},r.next=7,t.config.logUserConsentFunc(u);case 7:s=r.sent,n.setUserConsent(s),a(s),r.next=14;break;case 12:a(!0),n.setUserConsent(!0);case 14:r.next=20;break;case 16:r.prev=16,r.t0=r.catch(1),console.error(r.t0),a(!i);case 20:case"end":return r.stop()}},r,t,[[1,16]])}));return function(e){return r.apply(this,arguments)}}())}},{key:"getUserConsentFunc",value:function(){var e=this,t=this;return new x(function(){var n=f()(o.a.mark(function n(r){var a;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,(a=t.token)||r(!1),!e.config.getUserConsentFunc||"function"!=typeof e.config.getUserConsentFunc){n.next=11;break}return n.t0=r,n.next=7,e.config.getUserConsentFunc(a);case 7:n.t1=n.sent,(0,n.t0)(n.t1),n.next=12;break;case 11:r(!1);case 12:n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),console.error(n.t2),r(!1);case 18:case"end":return n.stop()}},n,e,[[0,14]])}));return function(e){return n.apply(this,arguments)}}())}},{key:"getUserToken",value:function(){var e=f()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.logined){e.next=3;break}return this.autoUpdateToken(),e.abrupt("return",this.token);case 3:return e.next=5,this._getUserToken(!0,1);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_getUserToken",value:function(){var e=f()(o.a.mark(function e(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new x(function(e){var a=t.getEndpoint(t.loginKcConfig),i={clientId:a.clientId,serviceName:t.loginKcConfig.serviceName,refresh:!!n};a.auth&&(i.authorizationUrl=a.auth),a.token&&(i.tokenUrl=a.token),p.a.getAccessTokenFunction(i).then(function(){var n=f()(o.a.mark(function n(a){return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.token=a.accessToken,t.token&&t.autoUpdateToken(),t.verifyToken(t.token)){n.next=8;break}if(!(r>0)){n.next=6;break}return e(t._getUserToken(!0,--r)),n.abrupt("return");case 6:return e(),n.abrupt("return");case 8:p.a.setStorage(t.primaryKey+m.a.SPLIT+t.config.cacheKey.TOKEN,t.token),e(t.token);case 10:case"end":return n.stop()}},n,t)}));return function(e){return n.apply(this,arguments)}}()).catch(function(t){console.error(t),e()})}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"verifyToken",value:function(e){try{if(!e)return!1;var t=p.a.decodeToken(e);return t.sub||0==t.sub?!(!t.channelId&&0!=t.channelId)||(p.a.showToast("token信息缺失：缺少channelId"),!1):(p.a.showToast("token信息缺失：缺少userId"),!1)}catch(e){return console.error(e),!1}}},{key:"autoUpdateToken",value:function(){var e=this;try{this.tokenInterval||(this.tokenInterval=setInterval(function(){e.isTokenAvaliable()||e._getUserToken()},3e4))}catch(e){console.error(e)}}},{key:"getCacheToken",value:function(){return p.a.getStorage(this.primaryKey+m.a.SPLIT+this.config.cacheKey.TOKEN)}},{key:"getLoginConfig",value:function(){var e=f()(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,"string"!=typeof t){e.next=5;break}return e.next=4,p.a.getJsonFile(t);case 4:n=e.sent;case 5:if(n.clientId=n.clientId||n.resource,n.clientId){e.next=8;break}throw new Error("clientId is empty");case 8:if(n.serviceName){e.next=10;break}throw new Error("serviceName is empty");case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getEndpoint",value:function(e){return{auth:e["auth-server-url"]?e["auth-server-url"]+"/realms/"+e.realm+"/protocol/openid-connect/auth":null,token:e["auth-server-url"]?e["auth-server-url"]+"/realms/"+e.realm+"/protocol/openid-connect/token":null,clientId:e.clientId}}}]),e}(),w={enableAgreement:!0,enableAuthorize:!0,userInfoParams:["userId","companyId","channelId"],urlWhiteList:[],apiWhiteList:[],cacheKey:m.a.CACHE_KEY,channelId:"",primaryKey:"",protocolKey:"",disagreeCb:null,appBackCb:null},T=T||window.Promise,S=(Object,function(){var e=f()(o.a.mark(function e(){var t,n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this,p.a.appBack(function(e){var t=this;p.a.stateManager.closeTopPop(function(){t.mergedConfig.appBackCb?t.mergedConfig.appBackCb():p.a.goBackPage("")})}.bind(this)),p.a.reFreshPage(function(){}),this.authPromise=new T(function(){var e=f()(o.a.mark(function e(r){var a,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.authPromiseResolve=r,t.authHandler=new b(t.mergedConfig),e.next=4,t.authHandler.init();case 4:if(a=location.hash.indexOf("?"),i=location.hash.substring(1,a>-1?a:location.hash.length),t.authHandler.enableAuthorize()&&!t.mergedConfig.urlWhiteList.some(function(e){return i.startsWith(e)})){e.next=10;break}t.complete(),e.next=20;break;case 10:if(e.t0=t.authHandler.logined,!e.t0){e.next=15;break}return e.next=14,t.authHandler.getUserConsent();case 14:e.t0=e.sent;case 15:if(!e.t0){e.next=19;break}return t.authHandler.autoUpdateToken(),t.complete(),e.abrupt("return");case 19:t.init();case 20:t.callHook("initialized");case 21:case"end":return e.stop()}},e,n)}));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}},e,this)}))}(),S||window.Promise),I={name:"swpServiceAuth",directives:{},components:{protocol:function(){return n.e(0).then(n.bind(null,"OkiS"))}},props:{config:{type:Object,default:{}}},data:function(){var e=p.a.extend(!0,w,this.config);return i()(p.a.stateManager.setData([],this),{protocolStatus:m.a.PROTOCOL_STATUS.CLOSE,protocolResolve:null,userAuthPromise:null,guestLoginPromise:null,protocols:{},checked:!1,isPC:p.a.isPC(),authPromiseResolve:null,authHandler:null,authorized:!1,mergedConfig:e})},created:function(){var e=f()(o.a.mark(function e(){var t,n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this,p.a.appBack(function(e){var t=this;p.a.stateManager.closeTopPop(function(){t.mergedConfig.appBackCb?t.mergedConfig.appBackCb():p.a.goBackPage("")})}.bind(this)),p.a.reFreshPage(function(){}),this.authPromise=new S(function(){var e=f()(o.a.mark(function e(r){var a,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.authPromiseResolve=r,t.authHandler=new b(t.mergedConfig),e.next=4,t.authHandler.init();case 4:if(a=location.hash.indexOf("?"),i=location.hash.substring(1,a>-1?a:location.hash.length),t.authHandler.enableAuthorize()&&!t.mergedConfig.urlWhiteList.some(function(e){return i.startsWith(e)})){e.next=10;break}t.complete(),e.next=20;break;case 10:if(e.t0=t.authHandler.logined,!e.t0){e.next=15;break}return e.next=14,t.authHandler.getUserConsent();case 14:e.t0=e.sent;case 15:if(!e.t0){e.next=19;break}return t.authHandler.autoUpdateToken(),t.complete(),e.abrupt("return");case 19:t.init();case 20:t.callHook("initialized");case 21:case"end":return e.stop()}},e,n)}));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),computed:{hasAuthFiles:function(){var e=this.protocols;return!!e&&("file"==e.type?e.authFiles&&e.authFiles.length>0:"text"==e.type?e.protocolContent:void 0)}},mounted:function(){},methods:{init:function(){var e=this;return f()(o.a.mark(function t(){var n,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e,t.next=3,e.authHandler.getUserToken(!0,1);case 3:if(t.sent){t.next=7;break}return e.protocolStatus=m.a.PROTOCOL_STATUS.FAILED,t.abrupt("return");case 7:n=e.authHandler.getUserConsent(),r=e.authHandler.getAuthContent(),S.allSettled([n,r]).then(function(t){var n=e.mergedConfig.enableAuthorize,r=t[0].value;e.protocols=t[1].value,!!n&&!r&&e.hasAuthFiles&&e.mergedConfig.enableAgreement?e.protocolStatus=m.a.PROTOCOL_STATUS.SHOW:e.complete()});case 10:case"end":return t.stop()}},t,e)}))()},eventListener:function(e){this.callHook(e.name,e.params)},confirmFailed:function(){this.goBackPage()},refresh:function(){this.showAuthorize&&this.initData()},goBackPage:function(){p.a.goBackPage("-11111111111111111111111111")},complete:function(){var e={},t=this.authHandler.getCacheToken();if(t){var n=p.a.decodeToken(t);this.mergedConfig.userInfoParams.forEach(function(t){e[t]="userId"==t?n.sub:n[t]})}this.authPromiseResolve&&this.authPromiseResolve(e),this.authorized=!0,this.protocolStatus=m.a.PROTOCOL_STATUS.COMPLETE,this.protocolResolve&&this.protocolResolve(!0),this.callHook("completed")},callHook:function(e,t){this.$emit(e,t),this[e]&&"function"==typeof this[e]&&this[e](t)},reloadProtocol:function(){var e=this;return new S(function(t){var n=e.authHandler.getUserConsent(),r=e.authHandler.getAuthContent();S.allSettled([n,r]).then(function(n){var r=n[0].value;e.protocols=n[1].value,!r&&e.hasAuthFiles?(e.protocolStatus=m.a.PROTOCOL_STATUS.SHOW,e.protocolResolve=t):t(!1)}).catch(function(e){console.error("加载授权协议出错！"+e),t(!1)})})},closeProtocol:function(){this.protocolStatus=m.a.PROTOCOL_STATUS.CLOSE},authInterceptor:function(e,t){var n=this;return new S(function(r,o){var a=location.hash.substring(1,location.hash.indexOf("?"));!n.mergedConfig.enableAuthorize||t&&n.mergedConfig.apiWhiteList.some(function(e){return t.startsWith(e)})||n.mergedConfig.urlWhiteList.some(function(e){return a.startsWith(e)})?r(e):S.all([n.authPromise]).then(function(t){e||(e={}),n.mergedConfig.userInfoParams.forEach(function(n){e[n]=t[0][n]}),r(e)}).catch(function(e){console.error(e),o()})})}}},P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"authorize-container",attrs:{"cust-style":""}},[n("protocol",{ref:"protocol",attrs:{protocols:e.protocols,config:e.mergedConfig,authHandler:e.authHandler},on:{confirmFailed:e.confirmFailed,complete:e.complete,eventListener:e.eventListener,showProtocol:function(t){return e.callHook("onShowProtocol")}},model:{value:e.protocolStatus,callback:function(t){e.protocolStatus=t},expression:"protocolStatus"}})],1)};P._withStripped=!0;var C={render:P,staticRenderFns:[]},O=C;var _=n("VU/8")(I,O,!1,null,null,null);_.options.__file="src/version/v3/src/authorize.vue";var E=_.exports,U=n("oAV5");n.d(t,"install",function(){return L});var A=h.a.extend(E),L=function(){var e=f()(o.a.mark(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new u.a(function(e,r){try{h.a.$AuthorizeComp&&h.a.$AuthorizeComp.$destroy();var o=null,a="AuthorizeComp",c=document.getElementById(a);c&&c.remove();var s=document.createElement("div");s.id=a,document.body.appendChild(s),"string"==typeof t&&(o=U.a.getJsonFile(t)),u.a.all([o]).then(function(r){r[0]&&(t=r[0]);var o=new A({el:s,propsData:{config:t},methods:n});h.a.prototype.$authorize=o,e(i()({},{$instance:o,authInterceptor:o.authInterceptor,isAuthorized:function(){return o.$data.authorized},getToken:function(){return o.authHandler.getCacheToken()},getTchatUserInfo:function(){return i()(o.authHandler.tchatUserInfo,{prodId:U.a.getNonnullValue(o.authHandler.channelId)})},getUserInfo:function(){try{var e=o.authHandler.getCacheToken();if(!e)throw"no user token!";var t=U.a.decodeToken(e);return{userId:U.a.getNonnullValue(t.sub),companyId:U.a.getNonnullValue(o.authHandler.tchatUserInfo.cpyId),companyName:U.a.getNonnullValue(o.authHandler.tchatUserInfo.cpyName),channelId:U.a.getNonnullValue(t.channelId),channelName:U.a.getNonnullValue(t.channelName),userName:U.a.getNonnullValue(t.userName)}}catch(e){return console.error(e),{}}},closeAuthDetail:function(){return o.closeAuthDetail()},reloadProtocol:function(){o.reloadProtocol()},closeProtocol:function(){o.closeProtocol()}},U.a))})}catch(e){console.error(e),r()}}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},"82Mu":function(e,t,n){var r=n("7KvD"),o=n("L42u").set,a=r.MutationObserver||r.WebKitMutationObserver,i=r.process,c=r.Promise,u="process"==n("R9M2")(i);e.exports=function(){var e,t,n,s=function(){var r,o;for(u&&(r=i.domain)&&r.exit();e;){o=e.fn,e=e.next;try{o()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){i.nextTick(s)};else if(!a||r.navigator&&r.navigator.standalone)if(c&&c.resolve){var f=c.resolve(void 0);n=function(){f.then(s)}}else n=function(){o.call(r,s)};else{var l=!0,h=document.createTextNode("");new a(s).observe(h,{characterData:!0}),n=function(){h.data=l=!l}}return function(r){var o={fn:r,next:void 0};t&&(t.next=o),e||(e=o,n()),t=o}}},"880/":function(e,t,n){e.exports=n("hJx8")},"94VQ":function(e,t,n){"use strict";var r=n("Yobk"),o=n("X8DO"),a=n("e6n0"),i={};n("hJx8")(i,n("dSzd")("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(i,{next:o(1,n)}),a(e,t+" Iterator")}},"9bBU":function(e,t,n){n("mClu");var r=n("FeBl").Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},BwfY:function(e,t,n){n("fWfb"),n("M6a0"),n("OYls"),n("QWe/"),e.exports=n("FeBl").Symbol},C4MV:function(e,t,n){e.exports={default:n("9bBU"),__esModule:!0}},CXw9:function(e,t,n){"use strict";var r,o,a,i,c=n("O4g8"),u=n("7KvD"),s=n("+ZMJ"),f=n("RY/4"),l=n("kM2E"),h=n("EqjI"),p=n("lOnJ"),d=n("2KxR"),v=n("NWt+"),g=n("t8x9"),y=n("L42u").set,m=n("82Mu")(),k=n("qARP"),x=n("dNDb"),b=n("iUbK"),w=n("fJUb"),T=u.TypeError,S=u.process,I=S&&S.versions,P=I&&I.v8||"",C=u.Promise,O="process"==f(S),_=function(){},E=o=k.f,U=!!function(){try{var e=C.resolve(1),t=(e.constructor={})[n("dSzd")("species")]=function(e){e(_,_)};return(O||"function"==typeof PromiseRejectionEvent)&&e.then(_)instanceof t&&0!==P.indexOf("6.6")&&-1===b.indexOf("Chrome/66")}catch(e){}}(),A=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},L=function(e,t){if(!e._n){e._n=!0;var n=e._c;m(function(){for(var r=e._v,o=1==e._s,a=0,i=function(t){var n,a,i,c=o?t.ok:t.fail,u=t.resolve,s=t.reject,f=t.domain;try{c?(o||(2==e._h&&R(e),e._h=1),!0===c?n=r:(f&&f.enter(),n=c(r),f&&(f.exit(),i=!0)),n===t.promise?s(T("Promise-chain cycle")):(a=A(n))?a.call(n,u,s):u(n)):s(r)}catch(e){f&&!i&&f.exit(),s(e)}};n.length>a;)i(n[a++]);e._c=[],e._n=!1,t&&!e._h&&N(e)})}},N=function(e){y.call(u,function(){var t,n,r,o=e._v,a=K(e);if(a&&(t=x(function(){O?S.emit("unhandledRejection",o,e):(n=u.onunhandledrejection)?n({promise:e,reason:o}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",o)}),e._h=O||K(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},K=function(e){return 1!==e._h&&0===(e._a||e._c).length},R=function(e){y.call(u,function(){var t;O?S.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})})},F=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),L(t,!0))},j=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw T("Promise can't be resolved itself");(t=A(e))?m(function(){var r={_w:n,_d:!1};try{t.call(e,s(j,r,1),s(F,r,1))}catch(e){F.call(r,e)}}):(n._v=e,n._s=1,L(n,!1))}catch(e){F.call({_w:n,_d:!1},e)}}};U||(C=function(e){d(this,C,"Promise","_h"),p(e),r.call(this);try{e(s(j,this,1),s(F,this,1))}catch(e){F.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n("xH/j")(C.prototype,{then:function(e,t){var n=E(g(this,C));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=O?S.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&L(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new r;this.promise=e,this.resolve=s(j,e,1),this.reject=s(F,e,1)},k.f=E=function(e){return e===C||e===i?new a(e):o(e)}),l(l.G+l.W+l.F*!U,{Promise:C}),n("e6n0")(C,"Promise"),n("bRrM")("Promise"),i=n("FeBl").Promise,l(l.S+l.F*!U,"Promise",{reject:function(e){var t=E(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(c||!U),"Promise",{resolve:function(e){return w(c&&this===i?C:this,e)}}),l(l.S+l.F*!(U&&n("dY0y")(function(e){C.all(e).catch(_)})),"Promise",{all:function(e){var t=this,n=E(t),r=n.resolve,o=n.reject,a=x(function(){var n=[],a=0,i=1;v(e,!1,function(e){var c=a++,u=!1;n.push(void 0),i++,t.resolve(e).then(function(e){u||(u=!0,n[c]=e,--i||r(n))},o)}),--i||r(n)});return a.e&&o(a.v),n.promise},race:function(e){var t=this,n=E(t),r=n.reject,o=x(function(){v(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return o.e&&r(o.v),n.promise}})},D2L2:function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},DuQW:function(e,t,n){"use strict";var r=n("woOf"),o=n.n(r),a=n("0xDb"),i=[],c={};t.a=function(){var e;o()(a.a.ErrorCodeMap,c),(e=a.a.WhiteList.global).push.apply(e,i)}},EGZi:function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},EqBC:function(e,t,n){"use strict";var r=n("kM2E"),o=n("FeBl"),a=n("7KvD"),i=n("t8x9"),c=n("fJUb");r(r.P+r.R,"Promise",{finally:function(e){var t=i(this,o.Promise||a.Promise),n="function"==typeof e;return this.then(n?function(n){return c(t,e()).then(function(){return n})}:e,n?function(n){return c(t,e()).then(function(){throw n})}:e)}})},EqjI:function(e,t){e.exports=function(e){return"object"===typeof e?null!==e:"function"===typeof e}},FVbR:function(e,t,n){"use strict";var r=n("//Fk"),o=n.n(r),a=n("Y+Xn");t.a={getAccessTokenFunction:function(e){try{var t=a.a.getUserPara("ProdId");if(t&&["4866"].indexOf(t.toString())>-1)return o.a.resolve({ret:"404"})}catch(e){console.error(e)}return a.a.callHandler("GetAccessTokenFunction",e)},getIdTokenFunction:function(e){try{var t=a.a.getUserPara("ProdId");if(t&&["4866"].indexOf(t.toString())>-1)return o.a.resolve({ret:"404"})}catch(e){console.error(e)}return a.a.callHandler("GetIdTokenFunction",e)},getUserInfoFunction:function(e){return a.a.callHandler("GetUserInfoFunction",e)},getAppConfigFunction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.a.callHandler("GetAppConfigFunction",e)},appBack:function(e,t){try{a.a.callHandler("notifyAppBackEvent",""),a.a.registerHandler("notifyAppBack",function(){e.call(t)}.bind(this))}catch(e){console.error(e)}},reFreshPage:function(e){var t=[{name:"刷新",menuId:"5",type:2,func:e}];a.a.callHandler("RegisterMenuFunction",a.a.isPC()?null:t),a.a.registerHandler("clickMenuCallBack",function(e){if("String"===Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]&&(e=JSON.parse(e)),t)for(var n=0;n<t.length;n++)if(e.menuId==t[n].menuId&&t[n].func){t[n].func();break}}.bind(this))},CheckNetWorkFunction:function(e){var t=this;return new o.a(function(n){t.getNetInfoFunction(e).then(function(e){n(!!e&&!!e.contectState)}).catch(function(e){n(!0)})})},getNetInfoFunction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return a.a.callHandler("CheckNetWorkFunction",e)}}},FeBl:function(e,t){var n=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=n)},HR9g:function(e,t,n){"use strict";t.a={SPLIT:"_",IDENTITY:{GUEST:"guest",USER:"user"},CACHE_KEY:{TOKEN:"token",USER_CONSENT:"userConsent",IDENTITY:"identity"},AUTH_PARAMS_IN_URL:["idToken","clientId","clientSecret"],PROTOCOL_STATUS:{SHOW:1,HIDE:0,FAILED:-1,COMPLETED:2}}},Ibhu:function(e,t,n){var r=n("D2L2"),o=n("TcQ7"),a=n("vFc/")(!1),i=n("ax3d")("IE_PROTO");e.exports=function(e,t){var n,c=o(e),u=0,s=[];for(n in c)n!=i&&r(c,n)&&s.push(n);for(;t.length>u;)r(c,n=t[u++])&&(~a(s,n)||s.push(n));return s}},Kh4W:function(e,t,n){t.f=n("dSzd")},L42u:function(e,t,n){var r,o,a,i=n("+ZMJ"),c=n("knuC"),u=n("RPLV"),s=n("ON07"),f=n("7KvD"),l=f.process,h=f.setImmediate,p=f.clearImmediate,d=f.MessageChannel,v=f.Dispatch,g=0,y={},m=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},k=function(e){m.call(e.data)};h&&p||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return y[++g]=function(){c("function"==typeof e?e:Function(e),t)},r(g),g},p=function(e){delete y[e]},"process"==n("R9M2")(l)?r=function(e){l.nextTick(i(m,e,1))}:v&&v.now?r=function(e){v.now(i(m,e,1))}:d?(a=(o=new d).port2,o.port1.onmessage=k,r=i(a.postMessage,a,1)):f.addEventListener&&"function"==typeof postMessage&&!f.importScripts?(r=function(e){f.postMessage(e+"","*")},f.addEventListener("message",k,!1)):r="onreadystatechange"in s("script")?function(e){u.appendChild(s("script")).onreadystatechange=function(){u.removeChild(this),m.call(e)}}:function(e){setTimeout(i(m,e,1),0)}),e.exports={set:h,clear:p}},LKZe:function(e,t,n){var r=n("NpIQ"),o=n("X8DO"),a=n("TcQ7"),i=n("MmMw"),c=n("D2L2"),u=n("SfB7"),s=Object.getOwnPropertyDescriptor;t.f=n("+E39")?s:function(e,t){if(e=a(e),t=i(t,!0),u)try{return s(e,t)}catch(e){}if(c(e,t))return o(!r.f.call(e,t),e[t])}},M6a0:function(e,t){},MU5D:function(e,t,n){var r=n("R9M2");e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},Mhyx:function(e,t,n){var r=n("/bQp"),o=n("dSzd")("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[o]===e)}},MmMw:function(e,t,n){var r=n("EqjI");e.exports=function(e,t){if(!r(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},"NWt+":function(e,t,n){var r=n("+ZMJ"),o=n("msXi"),a=n("Mhyx"),i=n("77Pl"),c=n("QRG4"),u=n("3fs2"),s={},f={};(t=e.exports=function(e,t,n,l,h){var p,d,v,g,y=h?function(){return e}:u(e),m=r(n,l,t?2:1),k=0;if("function"!=typeof y)throw TypeError(e+" is not iterable!");if(a(y)){for(p=c(e.length);p>k;k++)if((g=t?m(i(d=e[k])[0],d[1]):m(e[k]))===s||g===f)return g}else for(v=y.call(e);!(d=v.next()).done;)if((g=o(v,m,d.value,t))===s||g===f)return g}).BREAK=s,t.RETURN=f},NpIQ:function(e,t){t.f={}.propertyIsEnumerable},O4g8:function(e,t){e.exports=!0},ON07:function(e,t,n){var r=n("EqjI"),o=n("7KvD").document,a=r(o)&&r(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},OYls:function(e,t,n){n("crlp")("asyncIterator")},PzxK:function(e,t,n){var r=n("D2L2"),o=n("sB3e"),a=n("ax3d")("IE_PROTO"),i=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=o(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?i:null}},QRG4:function(e,t,n){var r=n("UuGF"),o=Math.min;e.exports=function(e){return e>0?o(r(e),9007199254740991):0}},"QWe/":function(e,t,n){n("crlp")("observable")},R4wc:function(e,t,n){var r=n("kM2E");r(r.S+r.F,"Object",{assign:n("To3L")})},R9M2:function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},RPLV:function(e,t,n){var r=n("7KvD").document;e.exports=r&&r.documentElement},"RY/4":function(e,t,n){var r=n("R9M2"),o=n("dSzd")("toStringTag"),a="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,i;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?n:a?r(t):"Object"==(i=r(t))&&"function"==typeof t.callee?"Arguments":i}},Rrel:function(e,t,n){var r=n("TcQ7"),o=n("n0T6").f,a={}.toString,i="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return i&&"[object Window]"==a.call(e)?function(e){try{return o(e)}catch(e){return i.slice()}}(e):o(r(e))}},S82l:function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},SfB7:function(e,t,n){e.exports=!n("+E39")&&!n("S82l")(function(){return 7!=Object.defineProperty(n("ON07")("div"),"a",{get:function(){return 7}}).a})},SldL:function(e,t){!function(t){"use strict";var n,r=Object.prototype,o=r.hasOwnProperty,a="function"===typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag",s="object"===typeof e,f=t.regeneratorRuntime;if(f)s&&(e.exports=f);else{(f=t.regeneratorRuntime=s?e.exports:{}).wrap=x;var l="suspendedStart",h="suspendedYield",p="executing",d="completed",v={},g={};g[i]=function(){return this};var y=Object.getPrototypeOf,m=y&&y(y(U([])));m&&m!==r&&o.call(m,i)&&(g=m);var k=S.prototype=w.prototype=Object.create(g);T.prototype=k.constructor=S,S.constructor=T,S[u]=T.displayName="GeneratorFunction",f.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===T||"GeneratorFunction"===(t.displayName||t.name))},f.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(k),e},f.awrap=function(e){return{__await:e}},I(P.prototype),P.prototype[c]=function(){return this},f.AsyncIterator=P,f.async=function(e,t,n,r){var o=new P(x(e,t,n,r));return f.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},I(k),k[u]="Generator",k[i]=function(){return this},k.toString=function(){return"[object Generator]"},f.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},f.values=U,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,o){return c.type="throw",c.arg=e,t.next=r,o&&(t.method="next",t.arg=n),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),s=o.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;_(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:U(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),v}}}function x(e,t,n,r){var o=t&&t.prototype instanceof w?t:w,a=Object.create(o.prototype),i=new E(r||[]);return a._invoke=function(e,t,n){var r=l;return function(o,a){if(r===p)throw new Error("Generator is already running");if(r===d){if("throw"===o)throw a;return A()}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var c=C(i,n);if(c){if(c===v)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var u=b(e,t,n);if("normal"===u.type){if(r=n.done?d:h,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}(e,n,i),a}function b(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function w(){}function T(){}function S(){}function I(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function P(e){var t;this._invoke=function(n,r){function a(){return new Promise(function(t,a){!function t(n,r,a,i){var c=b(e[n],e,r);if("throw"!==c.type){var u=c.arg,s=u.value;return s&&"object"===typeof s&&o.call(s,"__await")?Promise.resolve(s.__await).then(function(e){t("next",e,a,i)},function(e){t("throw",e,a,i)}):Promise.resolve(s).then(function(e){u.value=e,a(u)},i)}i(c.arg)}(n,r,t,a)})}return t=t?t.then(a,a):a()}}function C(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,C(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=b(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,v;var a=o.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,v):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function U(e){if(e){var t=e[i];if(t)return t.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(o.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},TQ8S:function(e,t,n){var r=function(){var e=document.currentScript;return e.src.substring(0,e.src.lastIndexOf("/")+1)}();n.p=r},TcQ7:function(e,t,n){var r=n("MU5D"),o=n("52gC");e.exports=function(e){return r(o(e))}},To3L:function(e,t,n){"use strict";var r=n("+E39"),o=n("lktj"),a=n("1kS7"),i=n("NpIQ"),c=n("sB3e"),u=n("MU5D"),s=Object.assign;e.exports=!s||n("S82l")(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=s({},e)[n]||Object.keys(s({},t)).join("")!=r})?function(e,t){for(var n=c(e),s=arguments.length,f=1,l=a.f,h=i.f;s>f;)for(var p,d=u(arguments[f++]),v=l?o(d).concat(l(d)):o(d),g=v.length,y=0;g>y;)p=v[y++],r&&!h.call(d,p)||(n[p]=d[p]);return n}:s},U5ju:function(e,t,n){n("M6a0"),n("zQR9"),n("+tPU"),n("CXw9"),n("EqBC"),n("jKW+"),e.exports=n("FeBl").Promise},UuGF:function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},V3tA:function(e,t,n){n("R4wc"),e.exports=n("FeBl").Object.assign},"VU/8":function(e,t){e.exports=function(e,t,n,r,o,a){var i,c=e=e||{},u=typeof e.default;"object"!==u&&"function"!==u||(i=e,c=e.default);var s,f="function"===typeof c?c.options:c;if(t&&(f.render=t.render,f.staticRenderFns=t.staticRenderFns,f._compiled=!0),n&&(f.functional=!0),o&&(f._scopeId=o),a?(s=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},f._ssrRegister=s):r&&(s=r),s){var l=f.functional,h=l?f.render:f.beforeCreate;l?(f._injectStyles=s,f.render=function(e,t){return s.call(t),h(e,t)}):f.beforeCreate=h?[].concat(h,s):[s]}return{esModule:i,exports:c,options:f}}},X8DO:function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},Xc4G:function(e,t,n){var r=n("lktj"),o=n("1kS7"),a=n("NpIQ");e.exports=function(e){var t=r(e),n=o.f;if(n)for(var i,c=n(e),u=a.f,s=0;c.length>s;)u.call(e,i=c[s++])&&t.push(i);return t}},Xxa5:function(e,t,n){e.exports=n("jyFz")},"Y+Xn":function(e,t,n){"use strict";t.a=SnUtils},Yobk:function(e,t,n){var r=n("77Pl"),o=n("qio6"),a=n("xnc9"),i=n("ax3d")("IE_PROTO"),c=function(){},u=function(){var e,t=n("ON07")("iframe"),r=a.length;for(t.style.display="none",n("RPLV").appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[a[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(c.prototype=r(e),n=new c,c.prototype=null,n[i]=e):n=u(),void 0===t?n:o(n,t)}},Zrlr:function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},Zzip:function(e,t,n){e.exports={default:n("/n6Q"),__esModule:!0}},ax3d:function(e,t,n){var r=n("e8AB")("keys"),o=n("3Eo+");e.exports=function(e){return r[e]||(r[e]=o(e))}},bRrM:function(e,t,n){"use strict";var r=n("7KvD"),o=n("FeBl"),a=n("evD5"),i=n("+E39"),c=n("dSzd")("species");e.exports=function(e){var t="function"==typeof o[e]?o[e]:r[e];i&&t&&!t[c]&&a.f(t,c,{configurable:!0,get:function(){return this}})}},crlp:function(e,t,n){var r=n("7KvD"),o=n("FeBl"),a=n("O4g8"),i=n("Kh4W"),c=n("evD5").f;e.exports=function(e){var t=o.Symbol||(o.Symbol=a?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||c(t,e,{value:i.f(e)})}},dNDb:function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},dSzd:function(e,t,n){var r=n("e8AB")("wks"),o=n("3Eo+"),a=n("7KvD").Symbol,i="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=i&&a[e]||(i?a:o)("Symbol."+e))}).store=r},dY0y:function(e,t,n){var r=n("dSzd")("iterator"),o=!1;try{var a=[7][r]();a.return=function(){o=!0},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var n=!1;try{var a=[7],i=a[r]();i.next=function(){return{done:n=!0}},a[r]=function(){return i},e(a)}catch(e){}return n}},e6n0:function(e,t,n){var r=n("evD5").f,o=n("D2L2"),a=n("dSzd")("toStringTag");e.exports=function(e,t,n){e&&!o(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},e8AB:function(e,t,n){var r=n("FeBl"),o=n("7KvD"),a=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n("O4g8")?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},evD5:function(e,t,n){var r=n("77Pl"),o=n("SfB7"),a=n("MmMw"),i=Object.defineProperty;t.f=n("+E39")?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),o)try{return i(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},exGp:function(e,t,n){"use strict";t.__esModule=!0;var r,o=n("//Fk"),a=(r=o)&&r.__esModule?r:{default:r};t.default=function(e){return function(){var t=e.apply(this,arguments);return new a.default(function(e,n){return function r(o,i){try{var c=t[o](i),u=c.value}catch(e){return void n(e)}if(!c.done)return a.default.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}("next")})}}},fJUb:function(e,t,n){var r=n("77Pl"),o=n("EqjI"),a=n("qARP");e.exports=function(e,t){if(r(e),o(t)&&t.constructor===e)return t;var n=a.f(e);return(0,n.resolve)(t),n.promise}},fWfb:function(e,t,n){"use strict";var r=n("7KvD"),o=n("D2L2"),a=n("+E39"),i=n("kM2E"),c=n("880/"),u=n("06OY").KEY,s=n("S82l"),f=n("e8AB"),l=n("e6n0"),h=n("3Eo+"),p=n("dSzd"),d=n("Kh4W"),v=n("crlp"),g=n("Xc4G"),y=n("7UMu"),m=n("77Pl"),k=n("EqjI"),x=n("sB3e"),b=n("TcQ7"),w=n("MmMw"),T=n("X8DO"),S=n("Yobk"),I=n("Rrel"),P=n("LKZe"),C=n("1kS7"),O=n("evD5"),_=n("lktj"),E=P.f,U=O.f,A=I.f,L=r.Symbol,N=r.JSON,K=N&&N.stringify,R=p("_hidden"),F=p("toPrimitive"),j={}.propertyIsEnumerable,M=f("symbol-registry"),H=f("symbols"),D=f("op-symbols"),G=Object.prototype,B="function"==typeof L&&!!C.f,z=r.QObject,V=!z||!z.prototype||!z.prototype.findChild,W=a&&s(function(){return 7!=S(U({},"a",{get:function(){return U(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=E(G,t);r&&delete G[t],U(e,t,n),r&&e!==G&&U(G,t,r)}:U,J=function(e){var t=H[e]=S(L.prototype);return t._k=e,t},Y=B&&"symbol"==typeof L.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof L},Q=function(e,t,n){return e===G&&Q(D,t,n),m(e),t=w(t,!0),m(n),o(H,t)?(n.enumerable?(o(e,R)&&e[R][t]&&(e[R][t]=!1),n=S(n,{enumerable:T(0,!1)})):(o(e,R)||U(e,R,T(1,{})),e[R][t]=!0),W(e,t,n)):U(e,t,n)},q=function(e,t){m(e);for(var n,r=g(t=b(t)),o=0,a=r.length;a>o;)Q(e,n=r[o++],t[n]);return e},X=function(e){var t=j.call(this,e=w(e,!0));return!(this===G&&o(H,e)&&!o(D,e))&&(!(t||!o(this,e)||!o(H,e)||o(this,R)&&this[R][e])||t)},$=function(e,t){if(e=b(e),t=w(t,!0),e!==G||!o(H,t)||o(D,t)){var n=E(e,t);return!n||!o(H,t)||o(e,R)&&e[R][t]||(n.enumerable=!0),n}},Z=function(e){for(var t,n=A(b(e)),r=[],a=0;n.length>a;)o(H,t=n[a++])||t==R||t==u||r.push(t);return r},ee=function(e){for(var t,n=e===G,r=A(n?D:b(e)),a=[],i=0;r.length>i;)!o(H,t=r[i++])||n&&!o(G,t)||a.push(H[t]);return a};B||(c((L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(n){this===G&&t.call(D,n),o(this,R)&&o(this[R],e)&&(this[R][e]=!1),W(this,e,T(1,n))};return a&&V&&W(G,e,{configurable:!0,set:t}),J(e)}).prototype,"toString",function(){return this._k}),P.f=$,O.f=Q,n("n0T6").f=I.f=Z,n("NpIQ").f=X,C.f=ee,a&&!n("O4g8")&&c(G,"propertyIsEnumerable",X,!0),d.f=function(e){return J(p(e))}),i(i.G+i.W+i.F*!B,{Symbol:L});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)p(te[ne++]);for(var re=_(p.store),oe=0;re.length>oe;)v(re[oe++]);i(i.S+i.F*!B,"Symbol",{for:function(e){return o(M,e+="")?M[e]:M[e]=L(e)},keyFor:function(e){if(!Y(e))throw TypeError(e+" is not a symbol!");for(var t in M)if(M[t]===e)return t},useSetter:function(){V=!0},useSimple:function(){V=!1}}),i(i.S+i.F*!B,"Object",{create:function(e,t){return void 0===t?S(e):q(S(e),t)},defineProperty:Q,defineProperties:q,getOwnPropertyDescriptor:$,getOwnPropertyNames:Z,getOwnPropertySymbols:ee});var ae=s(function(){C.f(1)});i(i.S+i.F*ae,"Object",{getOwnPropertySymbols:function(e){return C.f(x(e))}}),N&&i(i.S+i.F*(!B||s(function(){var e=L();return"[null]"!=K([e])||"{}"!=K({a:e})||"{}"!=K(Object(e))})),"JSON",{stringify:function(e){for(var t,n,r=[e],o=1;arguments.length>o;)r.push(arguments[o++]);if(n=t=r[1],(k(t)||void 0!==e)&&!Y(e))return y(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!Y(t))return t}),r[1]=t,K.apply(N,r)}}),L.prototype[F]||n("hJx8")(L.prototype,F,L.prototype.valueOf),l(L,"Symbol"),l(Math,"Math",!0),l(r.JSON,"JSON",!0)},fkB2:function(e,t,n){var r=n("UuGF"),o=Math.max,a=Math.min;e.exports=function(e,t){return(e=r(e))<0?o(e+t,0):a(e,t)}},h65t:function(e,t,n){var r=n("UuGF"),o=n("52gC");e.exports=function(e){return function(t,n){var a,i,c=String(o(t)),u=r(n),s=c.length;return u<0||u>=s?e?"":void 0:(a=c.charCodeAt(u))<55296||a>56319||u+1===s||(i=c.charCodeAt(u+1))<56320||i>57343?e?c.charAt(u):a:e?c.slice(u,u+2):i-56320+(a-55296<<10)+65536}}},hJx8:function(e,t,n){var r=n("evD5"),o=n("X8DO");e.exports=n("+E39")?function(e,t,n){return r.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},iNR0:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("Xxa5"),o=n.n(r),a=n("woOf"),i=n.n(a),c=n("//Fk"),u=n.n(c),s=n("exGp"),f=n.n(s),l=n("lRwf"),h=n.n(l),p=(n("TQ8S"),n("0xDb")),d=n("Zrlr"),v=n.n(d),g=n("wxAW"),y=n.n(g),m=n("HR9g"),k=n("DuQW"),x=x||window.Promise,b=0,w=function(){function e(t){v()(this,e),this.config=t,this.loginKcConfig={},this.resourceProtectKcConfig={},Object(k.a)()}return y()(e,[{key:"isGuest",value:function(){return this.config._identity==m.a.IDENTITY.GUEST}},{key:"init",value:function(){var e=f()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isGuest()){e.next=6;break}return e.next=3,this.getTchatUserInfo();case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0={};case 7:return this.tchatUserInfo=e.t0,this.idToken=this.config.idToken,e.next=11,this.getChannelId();case 11:return this.channelId=e.sent,e.next=14,this.setKeycloakParams();case 14:return e.next=16,this.defineProperties();case 16:return this.logined=this.isLogined(),e.abrupt("return");case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"guestInit",value:function(){var e=f()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChannelId();case 2:return this.channelId=e.sent,e.next=5,this.setKeycloakParams();case 5:return e.next=7,this.defineProperties();case 7:return this.logined=this.isLogined(),e.abrupt("return");case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setKeycloakParams",value:function(){var e=f()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLoginConfig(this.config.loginKcConfig);case 2:if(this.loginKcConfig=e.sent,!this.enableResourceProtect()){e.next=9;break}return e.next=6,this.getResourceProtectConfig(this.config.resourceProtectKcConfig);case 6:this.resourceProtectKcConfig=e.sent,this.resourceProtectKcConfig.clientSecret||(this.resourceProtectKcConfig.clientSecret=p.a.getUserPara("clientSecret")),this.resourceProtectKcConfig.clientId||(this.resourceProtectKcConfig.clientId=p.a.getUserPara("clientId"));case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getTchatUserInfo",value:function(){var e=this;return new x(function(t){e.isGuest()&&t({}),p.a.getUserInfoFunction().then(function(e){var n=p.a.getNonnullValue(e.cpyId);n||p.a.showToast("用户信息缺失：cpyId为空"),t({uaId:p.a.getNonnullValue(e.UAId),cpyId:n,cpyName:p.a.getNonnullValue(e.cpyName),userName:p.a.getNonnullValue(e.uName),userPhone:p.a.getNonnullValue(e.uPhone)})}).catch(function(e){console.error(e),t()})})}},{key:"getChannelId",value:function(){var e=f()(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.channelId){e.next=3;break}return e.abrupt("return",this.channelId);case 3:if(!this.config.channelId){e.next=5;break}return e.abrupt("return",this.config.channelId);case 5:if(!this.isGuest()){e.next=7;break}return e.abrupt("return","");case 7:return e.next=9,p.a.getAppConfigFunction({key:"tid"});case 9:return t=e.sent,e.abrupt("return",t&&t.value);case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0);case 16:case"end":return e.stop()}},e,this,[[0,13]])}));return function(){return e.apply(this,arguments)}}()},{key:"packagePrimaryKey",value:function(){try{if(this.idToken){var e=p.a.decodeToken(this.idToken);return e?e.userId+"_"+this.tchatUserInfo.cpyId+"_"+this.loginKcConfig.clientId:""}return this.loginKcConfig.clientId}catch(e){return console.error(e),""}}},{key:"defineProperties",value:function(){var e=f()(o.a.mark(function e(){var t,n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this,this._primaryKey=null,Object.defineProperty(this,"primaryKey",{configurable:!0,enumerable:!0,set:function(e){t._primaryKey=e},get:function(){try{if("function"==typeof t.config.primaryKey){var e=this.idToken?p.a.decodeToken(this.idToken):{};return t.config.primaryKey({userId:e.userId,cpyId:t.tchatUserInfo.cpyId,channelId:t.channelId})}return t.config.primaryKey?t.config.primaryKey:(t._primaryKey||(t._primaryKey=t.packagePrimaryKey()),t._primaryKey)}catch(e){return""}}}),this.CONSENT_STORAGE_KEY=this.primaryKey?this.primaryKey+m.a.SPLIT+this.config.cacheKey.USER_CONSENT:null,this.setUserConsent=function(e){t.CONSENT_STORAGE_KEY&&e&&p.a.setStorage(t.CONSENT_STORAGE_KEY,e)},this.getUserConsent=f()(o.a.mark(function e(){var r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null==t._getUserConsent||void 0==t._getUserConsent){e.next=3;break}return e.abrupt("return",t._getUserConsent);case 3:if(t.CONSENT_STORAGE_KEY){e.next=5;break}return e.abrupt("return",!1);case 5:if(r="true"==p.a.getStorage(t.CONSENT_STORAGE_KEY)){e.next=10;break}return e.next=9,t.getUserConsentFunc();case 9:r=e.sent;case 10:return r&&p.a.setStorage(t.CONSENT_STORAGE_KEY,!0),t._getUserConsent=r,e.abrupt("return",!!r);case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",!1);case 18:case"end":return e.stop()}},e,n,[[0,15]])}));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isLogined",value:function(){try{var e=this.getCacheToken(),t=e?p.a.decodeToken(JSON.parse(e).access_token):null;return!(!t||p.a.isTokenExpired(t))&&(this.loginedToken=t,!0)}catch(e){return console.error(e),!1}}},{key:"getCacheToken",value:function(){return p.a.getStorage(this.primaryKey+m.a.SPLIT+this.config.cacheKey.TOKEN)}},{key:"enableResourceProtect",value:function(){return this.config.enanbleResourceProtect}},{key:"enableAuthorize",value:function(){return this.config.enableAuthorize}},{key:"getAuthContent",value:function(){var e=this;return new x(function(){var t=f()(o.a.mark(function t(n){var r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.config.getAppProtocolsFunc||"function"!=typeof e.config.getAppProtocolsFunc){t.next=8;break}return t.next=4,e.config.getAppProtocolsFunc(e.getAccessToken());case 4:r=t.sent,n(r),t.next=9;break;case 8:n();case 9:t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),console.error(t.t0),n();case 15:case"end":return t.stop()}},t,e,[[0,11]])}));return function(e){return t.apply(this,arguments)}}())}},{key:"consentAgreement",value:function(e){var t=this,n=this;return new x(function(){var r=f()(o.a.mark(function r(a){var i,c,u,s;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=t.config.logUserConsentFunc&&"function"==typeof t.config.logUserConsentFunc,r.prev=1,!i){r.next=12;break}return c=n.getAccessToken(),u={protocols:e,token:c},r.next=7,t.config.logUserConsentFunc(u);case 7:s=r.sent,n.setUserConsent(s),a(s),r.next=14;break;case 12:a(!0),n.setUserConsent(!0);case 14:r.next=20;break;case 16:r.prev=16,r.t0=r.catch(1),console.error(r.t0),a(!i);case 20:case"end":return r.stop()}},r,t,[[1,16]])}));return function(e){return r.apply(this,arguments)}}())}},{key:"getUserConsentFunc",value:function(){var e=this,t=this;return new x(function(){var n=f()(o.a.mark(function n(r){var a;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,(a=t.getAccessToken())||r(!1),!e.config.getUserConsentFunc||"function"!=typeof e.config.getUserConsentFunc){n.next=11;break}return n.t0=r,n.next=7,e.config.getUserConsentFunc(a);case 7:n.t1=n.sent,(0,n.t0)(n.t1),n.next=12;break;case 11:r(!1);case 12:n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),console.error(n.t2),r(!1);case 18:case"end":return n.stop()}},n,e,[[0,14]])}));return function(e){return n.apply(this,arguments)}}())}},{key:"getResourceToken",value:function(){var e=f()(o.a.mark(function e(){var t,n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.abrupt("return",new x(function(){var e=f()(o.a.mark(function e(r,a){var c,u,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.enableResourceProtect()){e.next=4;break}return n.resourceKeycloak={},r(),e.abrupt("return");case 4:return e.prev=4,c=function(){t.resourceKeycloak=i()({},t.resourceKeycloak,u),t.replaceTokenInUrl()},(u=new Keycloak(n.resourceProtectKcConfig)).onAuthRefreshSuccess=function(){c()},u.onAuthSuccess=function(){c()},s=!1,u.onAuthError=function(){s&&p.a.showToast("获取用户授权信息失败，请重新登陆")},e.next=13,u.init({onLoad:"client-credentials",kcType:"resourceToken",tokenStoreScope:"local",cacheKeyPre:"",clientSecretBase64:Base64.encode(config.clientId+":"+config.clientSecret),autoUpdateToken:!0});case 13:u.token?(s=!0,r()):a(),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(4),a(),console.error(e.t0);case 20:case"end":return e.stop()}},e,n,[[4,16]])}));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getLoginToken",value:function(){var e=f()(o.a.mark(function e(t,n){var r,a,c=this,u=function(){var e=f()(o.a.mark(function e(t,i){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n==m.a.IDENTITY.USER){e.next=3;break}return t(),e.abrupt("return");case 3:if(a.tokenParsed&&r.rollbackLogin((a.tokenParsed.sub||null)+"_"+(r.tchatUserInfo.cpyId||null)+"_"+(a.tokenParsed.channelId||null)),!(b<2)){e.next=12;break}return e.t0=t,e.next=8,r.getUserToken();case 8:e.t1=e.sent,(0,e.t0)(e.t1),e.next=14;break;case 12:b=0,i("exchange twice failed");case 14:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}();return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,a=new Keycloak(this.loginKcConfig),n==m.a.IDENTITY.USER&&this.logined&&this.loginedToken&&(a.tokenParsed=this.loginedToken),e.abrupt("return",new x(function(){var e=f()(o.a.mark(function e(s,f){var l,h;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l=function(){return n==m.a.IDENTITY.USER&&!r.userKeycloak.tokenParsed.channelId},h=function(){r.userKeycloak=i()({},r.userKeycloak,a)},a.onAuthRefreshSuccess=function(){h()},a.onAuthRefreshError=function(){r.getUserToken()},a.onAuthSuccess=function(){h(),l()},e.next=8,a.init(t);case 8:if(!l()&&a.token){e.next=19;break}return e.prev=9,e.next=12,u(s,f);case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(9),console.error(e.t0),f();case 18:return e.abrupt("return");case 19:c.verifyToken()||(c.rollbackLogin(),f()),r.logined=!0,r.setIdentity(n),s(a.token),e.next=29;break;case 25:e.prev=25,e.t1=e.catch(0),u(s,f).then(function(e){s(e)}).catch(function(){f()}),console.error(e.t1);case 29:case"end":return e.stop()}},e,c,[[0,25],[9,14]])}));return function(t,n){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"verifyToken",value:function(){var e=this.getCacheToken();if(!e)return!1;var t=p.a.decodeToken(JSON.parse(e).access_token);return t.sub||0==t.sub?!(!t.channelId&&0!=t.channelId)||(p.a.showToast("token信息缺失：缺少channelId"),!1):(p.a.showToast("token信息缺失：缺少userId"),!1)}},{key:"getUserToken",value:function(){var e=f()(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,this.idToken){e.next=3;break}return e.abrupt("return",this.getGuestToken());case 3:return b++,e.abrupt("return",t.getLoginToken({onLoad:"exchange-token",token:this.idToken,subjectIssuer:this.channelId,tokenStoreScope:"local",kcType:"token",cacheKeyPre:this.primaryKey,tokenType:"urn:ietf:params:oauth:token-type:jwt",autoUpdateToken:!0},m.a.IDENTITY.USER));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getGuestToken",value:function(){return this.getLoginToken({onLoad:"password",username:this.config.guestUserName,password:this.config.guestPassword,tokenStoreScope:"local",kcType:"token",cacheKeyPre:this.primaryKey,autoUpdateToken:!0},m.a.IDENTITY.GUEST)}},{key:"replaceTokenInUrl",value:function(){var e=this.resourceKeycloak.token,t=location.search,n=void 0;if(t){for(var r=t.substring(1).split("&"),o=0;o<r.length;o++)"access_token"==r[o].split("=")[0]&&(r[o]="access_token="+e);n=r.join("&")}else n="access_token="+e;var a=""+location.origin+location.pathname+"?"+n+location.hash;history.replaceState(null,null,a)}},{key:"getToken",value:function(){var e=f()(o.a.mark(function e(){var t,n,r=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getResourceToken(),n=this.getIdentity()==m.a.IDENTITY.GUEST?this.getGuestToken():this.getUserToken(),e.abrupt("return",new x(function(e){x.allSettled([t,n]).then(function(t){var n="fulfilled"==t[1].status;r.enableResourceProtect()&&(n=n&&"fulfilled"==t[0].status),e(n)})}));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"rollbackLogin",value:function(){p.a.removeStorage(this.primaryKey+m.a.SPLIT+this.config.cacheKey.TOKEN),p.a.removeSession(this.primaryKey+m.a.SPLIT+this.config.cacheKey.IDENTITY)}},{key:"setIdentity",value:function(e){p.a.setSession(this.primaryKey+m.a.SPLIT+this.config.cacheKey.IDENTITY,e)}},{key:"getIdentity",value:function(){return p.a.getSession(this.primaryKey+m.a.SPLIT+this.config.cacheKey.IDENTITY)}},{key:"getAccessToken",value:function(){var e=p.a.getStorage(this.primaryKey+m.a.SPLIT+this.config.cacheKey.TOKEN);try{return e?JSON.parse(e).access_token:null}catch(e){return console.error("get header token failed! ",e),null}}},{key:"getLoginConfig",value:function(){var e=f()(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,"string"!=typeof t){e.next=5;break}return e.next=4,p.a.getJsonFile(t);case 4:n=e.sent;case 5:if(n["auth-server-url"]){e.next=7;break}throw new Error("auth-server-url is empty");case 7:if(n.realm){e.next=9;break}throw new Error("realm is empty");case 9:if(n.clientId=n.clientId||n.resource,n.clientId){e.next=12;break}throw new Error("clientId is empty");case 12:return e.abrupt("return",{url:n["auth-server-url"],realm:n.realm,clientId:n.clientId});case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getResourceProtectConfig",value:function(){var e=f()(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t,"string"!=typeof t){e.next=5;break}return e.next=4,p.a.getJsonFile(t);case 4:n=e.sent;case 5:if(n["auth-server-url"]){e.next=7;break}throw new Error("auth-server-url is empty");case 7:if(n.realm){e.next=9;break}throw new Error("realm is empty");case 9:if(n.clientId){e.next=11;break}throw new Error("clientId is empty");case 11:if(n.clientSecret){e.next=13;break}throw new Error("clientSecret is empty");case 13:return e.abrupt("return",{url:n["auth-server-url"],realm:n.realm,clientId:n.clientId,clientSecret:n.clientSecret});case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),T={enableAgreement:!0,enableAuthorize:!0,enanbleResourceProtect:!1,loginKcConfig:null,resourceProtectKcConfig:null,userInfoParams:["userId","companyId","channelId"],urlWhiteList:[],apiWhiteList:[],cacheKey:m.a.CACHE_KEY,channelId:"",primaryKey:"",guestUserName:"guest",guestPassword:"guest"},S=S||window.Promise,I=(Object,function(){var e=f()(o.a.mark(function e(){var t,n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this,p.a.appBack(function(e){p.a.stateManager.closeTopPop(function(){p.a.goBackPage("")})}.bind(this)),p.a.reFreshPage(function(){}),this.authPromise=new S(function(){var e=f()(o.a.mark(function e(r){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.authPromiseResolve=r,t.authHandler=new w(t.mergedConfig),e.next=4,t.authHandler.init();case 4:if(a=location.hash.substring(1,location.hash.indexOf("?")),t.authHandler.enableAuthorize()&&!t.mergedConfig.urlWhiteList.some(function(e){return a.startsWith(e)})){e.next=9;break}t.complete(),e.next=18;break;case 9:if(e.t0=t.authHandler.logined,!e.t0){e.next=14;break}return e.next=13,t.authHandler.getUserConsent();case 13:e.t0=e.sent;case 14:if(!e.t0){e.next=17;break}return t.authHandler.getToken().then(function(e){e?t.complete():t.protocolStatus=m.a.PROTOCOL_STATUS.FAILED}),e.abrupt("return");case 17:t.init();case 18:t.callHook("initialized");case 19:case"end":return e.stop()}},e,n)}));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}},e,this)}))}(),I||window.Promise),P={name:"swpServiceAuth",directives:{},components:{protocol:function(){return n.e(0).then(n.bind(null,"OkiS"))}},props:{config:{type:Object,default:{}}},data:function(){var e=p.a.extend(!0,T,this.config);return i()(p.a.stateManager.setData([],this),{protocolStatus:m.a.PROTOCOL_STATUS.CLOSE,resourceAuthPromise:null,userAuthPromise:null,guestLoginPromise:null,protocols:{},checked:!1,isPC:p.a.isPC(),authPromiseResolve:null,authHandler:null,authorized:!1,mergedConfig:e})},created:function(){var e=f()(o.a.mark(function e(){var t,n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this,p.a.appBack(function(e){p.a.stateManager.closeTopPop(function(){p.a.goBackPage("")})}.bind(this)),p.a.reFreshPage(function(){}),this.authPromise=new I(function(){var e=f()(o.a.mark(function e(r){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.authPromiseResolve=r,t.authHandler=new w(t.mergedConfig),e.next=4,t.authHandler.init();case 4:if(a=location.hash.substring(1,location.hash.indexOf("?")),t.authHandler.enableAuthorize()&&!t.mergedConfig.urlWhiteList.some(function(e){return a.startsWith(e)})){e.next=9;break}t.complete(),e.next=18;break;case 9:if(e.t0=t.authHandler.logined,!e.t0){e.next=14;break}return e.next=13,t.authHandler.getUserConsent();case 13:e.t0=e.sent;case 14:if(!e.t0){e.next=17;break}return t.authHandler.getToken().then(function(e){e?t.complete():t.protocolStatus=m.a.PROTOCOL_STATUS.FAILED}),e.abrupt("return");case 17:t.init();case 18:t.callHook("initialized");case 19:case"end":return e.stop()}},e,n)}));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),computed:{hasAuthFiles:function(){var e=this.protocols;return!!e&&("file"==e.type?e.authFiles&&e.authFiles.length>0:"text"==e.type?e.protocolContent:void 0)}},mounted:function(){},methods:{init:function(){var e=this;return f()(o.a.mark(function t(){var n,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e,e.resourceAuthPromise=e.authHandler.getResourceToken(),t.next=4,e.mergedConfig.idToken;case 4:if(t.t0=!t.sent,t.t0){t.next=7;break}t.t0=!e.authHandler.channelId;case 7:if(!t.t0){t.next=8;break}case 8:return t.next=10,e.getUserAuthorize();case 10:if(t.sent){t.next=14;break}return e.protocolStatus=m.a.PROTOCOL_STATUS.FAILED,t.abrupt("return");case 14:if(!e.isGuest()){t.next=17;break}return e.complete(),t.abrupt("return");case 17:n=e.authHandler.getUserConsent(),r=e.authHandler.getAuthContent(),I.allSettled([e.resourceAuthPromise,n,r]).then(function(t){if("fulfilled"==t[0].status){var n=e.mergedConfig.enableAuthorize,r=t[1].value;e.protocols=t[2].value,!!n&&!r&&e.hasAuthFiles&&e.mergedConfig.enableAgreement?e.protocolStatus=m.a.PROTOCOL_STATUS.SHOW:e.complete()}else p.a.showToast("授权失败，请稍后重试")});case 20:case"end":return t.stop()}},t,e)}))()},getUserAuthorize:function(){var e=this;return new I(function(t){e.userAuthPromise=e.authHandler.getUserToken(),I.allSettled([e.resourceAuthPromise,e.userAuthPromise]).then(function(){var n=f()(o.a.mark(function n(r){return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:!1,"fulfilled"==r[1].status?t(!0):(t(!1),e.protocolStatus=m.a.PROTOCOL_STATUS.FAILED);case 2:case"end":return n.stop()}},n,e)}));return function(e){return n.apply(this,arguments)}}())})},guestLogin:function(){var e=this;this.guestLoginPromise=this.authHandler.getGuestToken(),I.all([this.resourceAuthPromise,this.guestLoginPromise]).then(function(t){e.complete()}).catch(function(e){p.a.showToast("授权失败，请稍后重试")})},eventListener:function(e){this.callHook(e.name,e.params)},refresh:function(){this.showAuthorize&&this.initData()},goBackPage:function(){p.a.goBackPage("-11111111111111111111111111")},confirmFailed:function(){this.goBackPage()},complete:function(){var e={},t=this.authHandler.userKeycloak.tokenParsed;t&&this.mergedConfig.userInfoParams.forEach(function(n){e[n]="userId"==n?t.sub:t[n]}),this.authPromiseResolve&&this.authPromiseResolve(e),this.authHandler.enableResourceProtect(),this.authorized=!0,this.protocolStatus=m.a.PROTOCOL_STATUS.COMPLETE,this.callHook("completed")},callHook:function(e,t){this.$emit(e,t),this[e]&&"function"==typeof this[e]&&this[e](t)},authInterceptor:function(e,t){var n=this;return new I(function(r,o){var a=location.hash.indexOf("?"),i=location.hash.substring(1,a>-1?a:location.hash.length);!n.mergedConfig.enableAuthorize||t&&n.mergedConfig.apiWhiteList.some(function(e){return t.startsWith(e)})||n.mergedConfig.urlWhiteList.some(function(e){return i.startsWith(e)})?r(e):I.all([n.authPromise]).then(function(t){e||(e={}),n.mergedConfig.userInfoParams.forEach(function(n){e[n]=t[0][n]}),r(e)}).catch(function(e){console.error(e),o()})})},isGuest:function(){return this.authHandler.isGuest()}}},C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"authorize-container",attrs:{"cust-style":""}},[n("protocol",{ref:"protocol",attrs:{protocols:e.protocols,config:e.mergedConfig,authHandler:e.authHandler},on:{confirmFailed:e.confirmFailed,complete:e.complete,eventListener:e.eventListener,showProtocol:function(t){return e.callHook("onShowProtocol")}},model:{value:e.protocolStatus,callback:function(t){e.protocolStatus=t},expression:"protocolStatus"}})],1)};C._withStripped=!0;var O={render:C,staticRenderFns:[]},_=O;var E=n("VU/8")(P,_,!1,null,null,null);E.options.__file="src/version/v2/src/authorize.vue";var U=E.exports,A=n("oAV5");n.d(t,"install",function(){return N}),t.guestLogin=function(e){var t=this;return new u.a(function(n){var r=A.a.loadKeycloakJs(e.kcAdapterUrl),a=null;"string"==typeof e&&(a=A.a.getJsonFile(e)),u.a.all([r,a]).then(function(){var r=f()(o.a.mark(function r(a){var i,c;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a[1]&&(e=a[1]),i=A.a.extend(!0,T,e),c=new w(i),t.next=5,c.guestInit();case 5:n(c.getGuestToken());case 6:case"end":return t.stop()}},r,t)}));return function(e){return r.apply(this,arguments)}}())})};var L=h.a.extend(U),N=function(){var e=f()(o.a.mark(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new u.a(function(e,r){try{h.a.$AuthorizeComp&&h.a.$AuthorizeComp.$destroy();var o=A.a.loadKeycloakJs(t.kcAdapterUrl),a=null,c="AuthorizeComp",s=document.getElementById(c);s&&s.remove();var f=document.createElement("div");f.id=c,document.body.appendChild(f),"string"==typeof t&&(a=A.a.getJsonFile(t)),u.a.all([o,a]).then(function(r){r[1]&&(t=r[1]);var o=new L({el:f,propsData:{config:t},methods:n});h.a.prototype.$authorize=o,e(i()({},{$instance:o,authInterceptor:o.authInterceptor,isAuthorized:function(){return o.$data.authorized},getToken:function(){try{var e=o.authHandler.getCacheToken();return e?JSON.parse(e).access_token:null}catch(e){return null}},getTchatUserInfo:function(){return i()(o.authHandler.tchatUserInfo,{prodId:A.a.getNonnullValue(o.authHandler.channelId)})},getUserInfo:function(){try{var e=o.authHandler.getCacheToken();if(!e)throw"no user token!";var t=A.a.decodeToken(JSON.parse(e).access_token);return{userId:A.a.getNonnullValue(t.sub),companyId:A.a.getNonnullValue(o.authHandler.tchatUserInfo.cpyId),companyName:A.a.getNonnullValue(o.authHandler.tchatUserInfo.cpyName),channelId:A.a.getNonnullValue(t.channelId),channelName:A.a.getNonnullValue(t.channelName),userName:A.a.getNonnullValue(t.userName)}}catch(e){return console.error(e),{}}},closeAuthDetail:function(){return o.closeAuthDetail()},isGuest:function(){return o.isGuest()}},A.a))})}catch(e){console.error(e),r()}}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},iUbK:function(e,t,n){var r=n("7KvD").navigator;e.exports=r&&r.userAgent||""},"jKW+":function(e,t,n){"use strict";var r=n("kM2E"),o=n("qARP"),a=n("dNDb");r(r.S,"Promise",{try:function(e){var t=o.f(this),n=a(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},jyFz:function(e,t,n){var r=function(){return this}()||Function("return this")(),o=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,a=o&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n("SldL"),o)r.regeneratorRuntime=a;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},kM2E:function(e,t,n){var r=n("7KvD"),o=n("FeBl"),a=n("+ZMJ"),i=n("hJx8"),c=n("D2L2"),u=function(e,t,n){var s,f,l,h=e&u.F,p=e&u.G,d=e&u.S,v=e&u.P,g=e&u.B,y=e&u.W,m=p?o:o[t]||(o[t]={}),k=m.prototype,x=p?r:d?r[t]:(r[t]||{}).prototype;for(s in p&&(n=t),n)(f=!h&&x&&void 0!==x[s])&&c(m,s)||(l=f?x[s]:n[s],m[s]=p&&"function"!=typeof x[s]?n[s]:g&&f?a(l,r):y&&x[s]==l?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(l):v&&"function"==typeof l?a(Function.call,l):l,v&&((m.virtual||(m.virtual={}))[s]=l,e&u.R&&k&&!k[s]&&i(k,s,l)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},knuC:function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},lOnJ:function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},lRwf:function(t,n){t.exports=e},lVK7:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"guestLogin",function(){return d}),t.install=function(e,t){var n=this;return new o.a(function(r){var a=location.hash.substring(1,location.hash.indexOf("?"));e.urlWhiteList&&e.urlWhiteList.some(function(e){return a.startsWith(e)})?r():o.a.all([v]).then(function(){var o=u()(i.a.mark(function o(a){var c,u;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return c=a[0],n.next=3,c(e,t);case 3:u=n.sent,r(u);case 5:case"end":return n.stop()}},o,n)}));return function(e){return o.apply(this,arguments)}}()).catch(function(e){throw console.error(e),e})})},n.d(t,"getGuestToken",function(){return g});var r=n("//Fk"),o=n.n(r),a=n("Xxa5"),i=n.n(a),c=n("exGp"),u=n.n(c),s=n("TQ8S"),f=(n.n(s),n("HR9g")),l=n("0xDb"),h=function(){var e=u()(i.a.mark(function e(t,r){var o,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.a.getIdToken();case 3:if(o=e.sent){e.next=11;break}if(t.getIdTokenByTGC){e.next=7;break}throw"no getIdTokenByTGC function";case 7:return e.next=9,t.getIdTokenByTGC();case 9:o=e.sent,t.idToken=o;case 11:return e.next=13,n("iNR0");case 13:return a=e.sent,e.abrupt("return",a.install(t,r));case 17:return e.prev=17,e.t0=e.catch(0),console.warn(e.t0),e.abrupt("return",d(t,r));case 21:case"end":return e.stop()}},e,this,[[0,17]])}));return function(t,n){return e.apply(this,arguments)}}(),p=function(){var e=u()(i.a.mark(function e(t,r){var o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n("825g");case 2:return o=e.sent,e.abrupt("return",o.install(t,r));case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),d=function(){var e=u()(i.a.mark(function e(t,r){var o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t._identity=f.a.IDENTITY.GUEST,e.next=3,n("iNR0");case 3:return o=e.sent,e.abrupt("return",o.install(t,r));case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),v=new o.a(function(e){var t=document.currentScript.src,n=(l.a.getUrlParams(t)||{}).version;if(null!=n&&void 0!=n){if("3.0"==n)return void e(p);if("2.0"==n)return void e(h);if("guest"==n)return void e(d)}l.a.getAccessTokenFunction().then(function(t){"404"!=t.ret&&t.accessToken?e(p):e(h)}).catch(function(t){console.error(t),e(h)})});var g=function(){var e=u()(i.a.mark(function e(t,r){var o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t._identity=f.a.IDENTITY.GUEST,e.next=3,n("iNR0");case 3:return o=e.sent,e.abrupt("return",o.getGuestToken(t,r));case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},lktj:function(e,t,n){var r=n("Ibhu"),o=n("xnc9");e.exports=Object.keys||function(e){return r(e,o)}},mClu:function(e,t,n){var r=n("kM2E");r(r.S+r.F*!n("+E39"),"Object",{defineProperty:n("evD5").f})},msXi:function(e,t,n){var r=n("77Pl");e.exports=function(e,t,n,o){try{return o?t(r(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&r(a.call(e)),t}}},mvHQ:function(e,t,n){e.exports={default:n("qkKv"),__esModule:!0}},n0T6:function(e,t,n){var r=n("Ibhu"),o=n("xnc9").concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,o)}},oAV5:function(e,t,n){"use strict";var r=n("Xxa5"),o=n.n(r),a=n("exGp"),i=n.n(a),c=n("pFYg"),u=n.n(c),s=n("//Fk"),f=n.n(s),l=n("HR9g"),h=n("Y+Xn"),p=n("FVbR"),d=this,v={decodeToken:function(e){try{switch((e=(e=(e=e.split(".")[1]).replace("/-/g","+")).replace("/_/g","/")).length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Invalid token"}return e=(e=(e+"===").slice(0,e.length+e.length%4)).replace(/-/g,"+").replace(/_/g,"/"),e=decodeURIComponent(escape(atob(e))),e=JSON.parse(e)}catch(e){return console.error(e),null}},removeUserParamOnUrl:function(e){try{var t=location.hash,n=t.indexOf("?");if(-1==n)return;var r=t.substring(0,n),o=t.substring(n+1,t.length);o=(o=o.split("&")).filter(function(t){var n=t.split("=")[0];return!(l.a.AUTH_PARAMS_IN_URL.indexOf(n)>-1||e.indexOf(n)>-1)}),history.replaceState(null,null,location.origin+location.pathname+location.search+r+(o&&o.length>0?"?":"")+o.join("&"))}catch(e){console.error("removeUserParamOnUrl error!",e)}},setUserParamOnUrl:function(e,t){try{var n=location.hash,r=n.indexOf("?"),o=r>-1?n.substring(0,r):n,a=n.substring(r+1,n.length);a=r>-1&&a?a.split("&"):[],e.forEach(function(e){t[e]&&a.push(e+"="+t[e])}),history.replaceState(null,null,location.origin+location.pathname+location.search+o+(a&&a.length>0?"?":"")+a.join("&"))}catch(e){console.error("setUserParamOnUrl error!",e)}},isTokenExpired:function(e,t){if(!e)return!0;var n=e.exp-Math.ceil((new Date).getTime()/1e3);if(t){if(isNaN(t))throw"Invalid minValidity";n-=t}return n<0}};Promise.allSettled=f.a.allSettled||function(e){return new this(function(t,n){if("[object Array]"!==Object.prototype.toString.call(e))return n(new TypeError(("undefined"===typeof e?"undefined":u()(e))+" "+e+"  is not iterable(cannot read property Symbol(Symbol.iterator))"));var r=Array.prototype.slice.call(e);if(0===r.length)return t([]);var o=r.length;function a(e,n){if("object"===("undefined"===typeof n?"undefined":u()(n))){var a=n.then;"function"===typeof a&&a.call(n,function(n){r[e]={status:"fulfilled",value:n},0===--o&&t(r)},function(n){r[e]={status:"rejected",reason:n},0===--o&&t(r)})}}for(var i=0;i<r.length;i++)a(i,r[i])})},v.getJsonFile=function(e){return new f.a(function(t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.setRequestHeader("Accept","application/json"),r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status)try{t(JSON.parse(r.responseText))}catch(e){console.error(e),n()}else console.error("get json file failed! http state is: "+r.status),n()},r.send()})},v.loadKeycloakJs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"./keycloak.sino.js";return new f.a(function(t,n){h.a.loadScript({src:e,id:"keycloakLib",onload:function(){t()},onerror:function(){n()}})})},v.getIdToken=i()(o.a.mark(function e(){var t,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.a.getIdTokenFunction();case 3:return t=e.sent,(n=t?t.idToken:null)||console.error("no idToken from app!"),e.abrupt("return",n);case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}},e,d,[[0,9]])})),v.getUrlParams=function(){var e={},t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.href).match(/[^#&\?]+=[^#&\?]*/gi);if(t)for(var n=0;n<t.length;n++){var r=t[n].split("=");e[r[0]]=decodeURI(r[1])}return e},v.extend=function e(){var t={},n=!1,r=0;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(n=arguments[0],r++);for(var o=function(r){for(var o in r)r.hasOwnProperty(o)&&(n&&"[object Object]"===Object.prototype.toString.call(r[o])?t[o]=e(t[o],r[o]):t[o]=r[o])};r<arguments.length;r++)o(arguments[r]);return t},v.getNonnullValue=function(e){return null!=e&&void 0!=e&&"null"!=e&&"undefined"!=e?e:null},v.firstLetterUpCase=function(e){return null==e||void 0==e||0==e.replace(/\s/g,"").length?e:e.substring(0,1).toUpperCase()+e.substring(1)},t.a=v},pFYg:function(e,t,n){"use strict";t.__esModule=!0;var r=i(n("Zzip")),o=i(n("5QVw")),a="function"===typeof o.default&&"symbol"===typeof r.default?function(e){return typeof e}:function(e){return e&&"function"===typeof o.default&&e.constructor===o.default&&e!==o.default.prototype?"symbol":typeof e};function i(e){return e&&e.__esModule?e:{default:e}}t.default="function"===typeof o.default&&"symbol"===a(r.default)?function(e){return"undefined"===typeof e?"undefined":a(e)}:function(e){return e&&"function"===typeof o.default&&e.constructor===o.default&&e!==o.default.prototype?"symbol":"undefined"===typeof e?"undefined":a(e)}},qARP:function(e,t,n){"use strict";var r=n("lOnJ");function o(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new o(e)}},qio6:function(e,t,n){var r=n("evD5"),o=n("77Pl"),a=n("lktj");e.exports=n("+E39")?Object.defineProperties:function(e,t){o(e);for(var n,i=a(t),c=i.length,u=0;c>u;)r.f(e,n=i[u++],t[n]);return e}},qkKv:function(e,t,n){var r=n("FeBl"),o=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},sB3e:function(e,t,n){var r=n("52gC");e.exports=function(e){return Object(r(e))}},t8x9:function(e,t,n){var r=n("77Pl"),o=n("lOnJ"),a=n("dSzd")("species");e.exports=function(e,t){var n,i=r(e).constructor;return void 0===i||void 0==(n=r(i)[a])?t:o(n)}},"vFc/":function(e,t,n){var r=n("TcQ7"),o=n("QRG4"),a=n("fkB2");e.exports=function(e){return function(t,n,i){var c,u=r(t),s=o(u.length),f=a(i,s);if(e&&n!=n){for(;s>f;)if((c=u[f++])!=c)return!0}else for(;s>f;f++)if((e||f in u)&&u[f]===n)return e||f||0;return!e&&-1}}},"vIB/":function(e,t,n){"use strict";var r=n("O4g8"),o=n("kM2E"),a=n("880/"),i=n("hJx8"),c=n("/bQp"),u=n("94VQ"),s=n("e6n0"),f=n("PzxK"),l=n("dSzd")("iterator"),h=!([].keys&&"next"in[].keys()),p=function(){return this};e.exports=function(e,t,n,d,v,g,y){u(n,t,d);var m,k,x,b=function(e){if(!h&&e in I)return I[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},w=t+" Iterator",T="values"==v,S=!1,I=e.prototype,P=I[l]||I["@@iterator"]||v&&I[v],C=P||b(v),O=v?T?b("entries"):C:void 0,_="Array"==t&&I.entries||P;if(_&&(x=f(_.call(new e)))!==Object.prototype&&x.next&&(s(x,w,!0),r||"function"==typeof x[l]||i(x,l,p)),T&&P&&"values"!==P.name&&(S=!0,C=function(){return P.call(this)}),r&&!y||!h&&!S&&I[l]||i(I,l,C),c[t]=C,c[w]=p,v)if(m={values:T?C:b("values"),keys:g?C:b("keys"),entries:O},y)for(k in m)k in I||a(I,k,m[k]);else o(o.P+o.F*(h||S),t,m);return m}},woOf:function(e,t,n){e.exports={default:n("V3tA"),__esModule:!0}},wxAW:function(e,t,n){"use strict";t.__esModule=!0;var r,o=n("C4MV"),a=(r=o)&&r.__esModule?r:{default:r};t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,a.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},xGkn:function(e,t,n){"use strict";var r=n("4mcu"),o=n("EGZi"),a=n("/bQp"),i=n("TcQ7");e.exports=n("vIB/")(Array,"Array",function(e,t){this._t=i(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,o(1)):o(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},"xH/j":function(e,t,n){var r=n("hJx8");e.exports=function(e,t,n){for(var o in t)n&&e[o]?e[o]=t[o]:r(e,o,t[o]);return e}},xnc9:function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},zQR9:function(e,t,n){"use strict";var r=n("h65t")(!0);n("vIB/")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})}})});