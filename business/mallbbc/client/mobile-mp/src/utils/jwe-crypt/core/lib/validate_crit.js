"use strict";var __read=this&&this.__read||function(r,e){var t="function"==typeof Symbol&&r[Symbol.iterator];if(!t)return r;var i,n,a=t.call(r),o=[];try{for(;(void 0===e||0<e--)&&!(i=a.next()).done;)o.push(i.value)}catch(r){n={error:r}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(n)throw n.error}}return o},__spreadArray=this&&this.__spreadArray||function(r,e,t){if(t||2===arguments.length)for(var i,n=0,a=e.length;n<a;n++)!i&&n in e||((i=i||Array.prototype.slice.call(e,0,n))[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},__values=this&&this.__values||function(r){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&"number"==typeof r.length)return{next:function(){return{value:(r=r&&i>=r.length?void 0:r)&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},errors_1=(Object.defineProperty(exports,"__esModule",{value:!0}),require("../util/errors"));function validateCrit(r,e,t,i,n){var a,o,l;if(void 0!==n.crit&&void 0===i.crit)throw new r('"crit" (Critical) Header Parameter MUST be integrity protected');if(!i||void 0===i.crit)return new Set;if(!Array.isArray(i.crit)||0===i.crit.length||i.crit.some(function(r){return"string"!=typeof r||0===r.length}))throw new r('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');l=void 0!==t?new Map(__spreadArray(__spreadArray([],__read(Object.entries(t)),!1),__read(e.entries()),!1)):e;try{for(var c=__values(i.crit),s=c.next();!s.done;s=c.next()){var d=s.value;if(!l.has(d))throw new errors_1.JOSENotSupported('Extension Header Parameter "'.concat(d,'" is not recognized'));if(void 0===n[d])throw new r('Extension Header Parameter "'.concat(d,'" is missing'));if(l.get(d)&&void 0===i[d])throw new r('Extension Header Parameter "'.concat(d,'" MUST be integrity protected'))}}catch(r){a={error:r}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(a)throw a.error}}return new Set(i.crit)}exports.default=validateCrit;