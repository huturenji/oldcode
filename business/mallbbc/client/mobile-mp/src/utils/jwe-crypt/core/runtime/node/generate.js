"use strict";var __awaiter=this&&this.__awaiter||function(e,o,s,c){return new(s=s||Promise)(function(t,r){function a(e){try{u(c.next(e))}catch(e){r(e)}}function n(e){try{u(c.throw(e))}catch(e){r(e)}}function u(e){var r;e.done?t(e.value):((r=e.value)instanceof s?r:new s(function(e){e(r)})).then(a,n)}u((c=c.apply(e,o||[])).next())})},__generator=this&&this.__generator||function(a,n){var u,o,s,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},i={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function e(t){return function(e){var r=[t,e];if(u)throw new TypeError("Generator is already executing.");for(;c=i&&r[i=0]?0:c;)try{if(u=1,o&&(s=2&r[0]?o.return:r[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,r[1])).done)return s;switch(o=0,(r=s?[2&r[0],s.value]:r)[0]){case 0:case 1:s=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,o=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3]))c.label=r[1];else if(6===r[0]&&c.label<s[1])c.label=s[1],s=r;else{if(!(s&&c.label<s[2])){s[2]&&c.ops.pop(),c.trys.pop();continue}c.label=s[2],c.ops.push(r)}}r=n.call(a,c)}catch(e){r=[6,e],o=0}finally{u=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}}},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},crypto_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateKeyPair=exports.generateSecret=void 0,require("crypto")),util_1=require("util"),random_1=__importDefault(require("./random")),check_modulus_length_1=require("./check_modulus_length"),errors_1=require("../../util/errors"),generate=(0,util_1.promisify)(crypto_1.generateKeyPair);function generateSecret(t){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(e){switch(t){case"HS256":case"HS384":case"HS512":case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":r=parseInt(t.substr(-3),10);break;case"A128KW":case"A192KW":case"A256KW":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(t.substring(1,4),10);break;default:throw new errors_1.JOSENotSupported('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}return[2,(0,crypto_1.createSecretKey)((0,random_1.default)(new Uint8Array(r>>3)))]})})}function generateKeyPair(a,n){var u;return __awaiter(this,void 0,void 0,function(){var r,t;return __generator(this,function(e){switch(e.label){case 0:switch(a){case"RS256":case"RS384":case"RS512":case"PS256":case"PS384":case"PS512":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":case"RSA1_5":return[3,1];case"ES256":return[3,3];case"ES256K":return[3,4];case"ES384":return[3,5];case"ES512":return[3,6];case"EdDSA":return[3,7];case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":return[3,8]}return[3,9];case 1:if("number"!=typeof(r=null!=(u=null==n?void 0:n.modulusLength)?u:2048)||r<2048)throw new errors_1.JOSENotSupported("invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return[4,generate("rsa",{modulusLength:r,publicExponent:65537})];case 2:return t=e.sent(),(0,check_modulus_length_1.setModulusLength)(t.privateKey,r),(0,check_modulus_length_1.setModulusLength)(t.publicKey,r),[2,t];case 3:return[2,generate("ec",{namedCurve:"P-256"})];case 4:return[2,generate("ec",{namedCurve:"secp256k1"})];case 5:return[2,generate("ec",{namedCurve:"P-384"})];case 6:return[2,generate("ec",{namedCurve:"P-521"})];case 7:switch(null==n?void 0:n.crv){case void 0:case"Ed25519":return[2,generate("ed25519")];case"Ed448":return[2,generate("ed448")];default:throw new errors_1.JOSENotSupported("invalid or unsupported crv option provided, supported values are Ed25519 and Ed448")}e.label=8;case 8:switch(null==n?void 0:n.crv){case void 0:case"P-256":case"P-384":case"P-521":return[2,generate("ec",{namedCurve:(null==n?void 0:n.crv)||"P-256"})];case"X25519":return[2,generate("x25519")];case"X448":return[2,generate("x448")];default:throw new errors_1.JOSENotSupported("invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}e.label=9;case 9:throw new errors_1.JOSENotSupported('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}})})}exports.generateSecret=generateSecret,exports.generateKeyPair=generateKeyPair;