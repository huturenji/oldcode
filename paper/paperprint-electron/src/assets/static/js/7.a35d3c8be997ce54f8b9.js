(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{120:function(e,t,a){"use strict";a.r(t)},121:function(e,t,a){"use strict";a.r(t)},213:function(e,t,a){"use strict";a.r(t);var n=a(102),s=a.n(n),r=a(103),i=a.n(r),c=(a(108),a(109),a(110)),o=a.n(c),l=a(113),u=a(114),p={components:{headBreadcrumb:function(){return a.e(0).then(a.bind(null,217))},namedcomp:function(){return a.e(3).then(a.bind(null,218))}},data:function(){return{bisType:"register",title:"注册纸纹",bisTitle:"核验纸纹",tagNum:"0000001",tagName:"",haveCamera:!1,optionsWrapShow:!1,bisRuning:!1,takenPhotoing:!1,coveImgData:a(104),scan_light_img:null,scan_base_img:null,PREVIEW_OPTIONS:[300,139,480,360],timer:null,interval:null,haveQrCode:null,appEnv:{},localAssetsPreStr:"../../../../",sourceTypeName:"凭证",active:!1,zoomStyle:window.devicePixelRatio>=1.5,gradientWrapper:!1,fadeAway:!1,scanIndex:0,labelId:0}},created:function(){this.timer&&clearInterval(this.timer),this.sequence()},mounted:function(){this.getAppEnv(),window.addEventListener("cameraInit",this.cameraInitHandler),this.deviceInit()},beforeDestroy:function(){this.timer&&clearInterval(this.timer),o.a.closeAll(),l.a.close("register")},watch:{tagName:function(e,t){this.active=e&&e.trim()&&this.haveCamera,this.handleInput(e)}},methods:{getAppEnv:function(){sessionStorage.getItem("appEnv")&&(this.appEnv=JSON.parse(sessionStorage.getItem("appEnv")),this.localAssetsPreStr=this.appEnv.isPackaged?"../../../../":"../../"),this.appEnv.preview_model?this.PREVIEW_OPTIONS=[300,139,480,360]:this.PREVIEW_OPTIONS=[300,139,0,0]},deviceInit:function(){var e=this;return i()(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.init({type:"register",cwnd:e.PREVIEW_OPTIONS,cameraOptions:e.appEnv.defaultCameraOptions});case 2:0!=t.sent&&e.confirm("确认","<div class='coverText'><span>未检测到纸纹仪，请检查纸纹仪是否连接正常</span></div>","warning",e.deviceInit,!0,"",!0,null,"",!1);case 4:case"end":return t.stop()}}),t,e)})))()},cameraInitHandler:function(e){e.target.removeEventListener("cameraInit",this.cameraInitHandler),e.detail.created&&"register"==e.detail.type&&this.bisInit()},cameraClosedHandler:function(e){e.target.removeEventListener("cameraClosed",this.cameraClosedHandler),alert("register---------"+e.detail.type),"register"!=e.detail.type&&this.deviceInit()},bisInit:function(){var e=this;return i()(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.haveCamera=!0,!e.appEnv.use_perspective){t.next=5;break}l.a.transmitInit(),t.next=12;break;case 5:return t.next=7,l.a.reflexInit();case 7:a=t.sent,e.tagName=e.tagName||a,e.timer&&clearInterval(e.timer),e.timer=setInterval(i()(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.reflexInit();case 2:a=t.sent,e.tagName=e.tagName||a;case 4:case"end":return t.stop()}}),t,e)}))),5e3),e.tagName?o.a.closeAll():o()({message:"请把纸纹仪对准"+e.sourceTypeName,type:"warning",duration:3e3});case 12:case"end":return t.stop()}}),t,e)})))()},btnCallback:function(){var e=this;return i()(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.closeAnimation(),!e.appEnv.preview_model){t.next=4;break}return t.next=4,l.a.show();case 4:e.bisRuning=!1;case 5:case"end":return t.stop()}}),t,e)})))()},closeAnimation:function(){this.scan_light_img=null,this.gradientWrapper=!1,this.fadeAway=!1},register:function(){var e=this;return i()(s.a.mark((function t(){var a,n,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.takenPhotoing&&!e.bisRuning){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,a=e.haveCamera,e.takenPhotoing=!0,t.t0=!a,!t.t0){t.next=9;break}return t.next=9,l.a.init(e.PREVIEW_OPTIONS);case 9:if(!e.haveCamera){t.next=30;break}if(e.tagName.trim().length){t.next=14;break}return o()({message:"请输入"+e.sourceTypeName+"号",type:"warning"}),e.takenPhotoing=!1,t.abrupt("return");case 14:if(e.active){t.next=16;break}return t.abrupt("return");case 16:return e.bisRuning=!0,t.next=19,l.a.getPhoto("captured_image.jpg");case 19:if(0!=t.sent){t.next=28;break}return e.appEnv.preview_model&&(e.coveImgData=e.localAssetsPreStr+"captured_image.jpg?t="+(new Date).getTime()),t.next=24,ipcRenderer.sendSync("checkFileExist",e.tagName);case 24:n=t.sent,e.checkFileExistReply(n),t.next=30;break;case 28:r={confirmButtonText:"确定",text:"<div  class='result warning'>注册失败，请确认纸纹仪是否连接正常</div>",type:"warning",center:!0,needRecord:!1,textUsedHtml:!0},e.confirm(r.confirmButtonText,r.text,r.type,e.btnCallback,r.center,"",r.textUsedHtml);case 30:t.next=37;break;case 32:t.prev=32,t.t1=t.catch(2),e.bisRuning=!1,e.takenPhotoing=!1,console.log(t.t1);case 37:case"end":return t.stop()}}),t,e,[[2,32]])})))()},checkFileExistReply:function(e){var t=this;return i()(s.a.mark((function a(){return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:0==e.code?(t.takenPhotoing=!1,t.confirm("确认覆盖","<div class=coverText><span>凭证号已存在，是否覆盖</span></div>","warning",t.register_core,!0,"",!0,t.btnCallback,"取消",!0)):t.register_core();case 1:case"end":return a.stop()}}),a,t)})))()},register_core:function(){var e=this;return i()(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.scanIndex=u.a.getScanIndex(e.labelId),e.scan_base_img=a(115)("./"+e.scanIndex+"/register_fuzzy.png"),e.scan_light_img=a(116),e.gradientWrapper=!0,setTimeout(i()(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ipcRenderer.sendSync("register",e.tagName);case 2:a=t.sent,e.registerReply(a);case 4:case"end":return t.stop()}}),t,e)}))),0);case 5:case"end":return t.stop()}}),t,e)})))()},registerReply:function(e){var t=this;return i()(s.a.mark((function a(){var n;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n=document.getElementById("scanBaseImgWrap"),t.animationendListener=t.createAnimationendListener(e),n.addEventListener("animationend",t.animationendListener);case 3:case"end":return a.stop()}}),a,t)})))()},createAnimationendListener:function(e){var t=this;return function(n){t.scan_light_img=null,t.fadeAway?(t.takenPhotoing=!1,0==e.code?t.registerAddRecord(e):-2==e.code?t.msg("注册失败,请填写"+t.sourceTypeName+"号","error"):t.msg("注册失败","error"),n.target.removeEventListener("animationend",t.animationendListener)):(t.scan_base_img=a(107)("./"+t.scanIndex+"/register.png"),t.fadeAway=!0,t.gradientWrapper=!1)}},openOptionContent:function(){this.haveCamera?this.optionsWrapShow=!0:this.alert("未发现纸纹仪，请检查设备是否正常","warning")},closeOptionsContent:function(){this.optionsWrapShow=!1},alert:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"提示",r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.$alert(e,s,{confirmButtonText:"确定",type:t,center:n,dangerouslyUseHTMLString:r,callback:function(e){a&&a()}})},msg:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1500;o()({message:e,type:t,duration:a,onClose:this.btnCallback,customClass:"el_msg"})},confirm:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"success",n=arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments[7],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"取消",o=arguments.length>9&&void 0!==arguments[9]&&arguments[9];this.$confirm(t,"",{confirmButtonText:e,showCancelButton:o,cancelButtonText:c,type:a,center:s,showClose:!1,dangerouslyUseHTMLString:r,customClass:"el_confirm",cancelButtonClass:"el_cancel_btn",confirmButtonClass:"el_ok_btn",closeOnClickModal:!1}).then((function(){n&&n()})).catch((function(){i&&i()}))},registerAddRecord:function(e){var t=this;return i()(s.a.mark((function a(){var n;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=null,sessionStorage.getItem("userInfo")&&(n=JSON.parse(sessionStorage.getItem("userInfo"))),a.next=4,ipcRenderer.sendSync("register_add_record",{labelNo:t.tagNum,labelName:t.tagName,labelHash:e.data.labelHash,registerUserId:n.userId||"HD7891",registerUserName:n.userName||"超级管理员",registerImg:e.data.registerImg||""});case 4:0==a.sent.code?(t.msg("注册成功","success"),t.sequence()):t.msg("注册失败","error");case 6:case"end":return a.stop()}}),a,t)})))()},sequence:function(){var e=this;return i()(s.a.mark((function t(){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ipcRenderer.sendSync("register_sequence");case 2:(a=t.sent)&&0==a.code&&(e.tagNum=a.data.seq);case 4:case"end":return t.stop()}}),t,e)})))()},gotoBack:function(){this.$router.replace("/entry")},toggleBisType:function(){this.$router.replace("/verify")},handleInput:function(e){var t=this;return i()(s.a.mark((function n(){var r;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.trim()&&t.haveCamera){n.next=4;break}t.coveImgData=a(104),n.next=9;break;case 4:return n.next=6,ipcRenderer.sendSync("register_search_record_precise",{labelName:e});case 6:"0"==(r=n.sent).code&&r.data&&r.data.pageList&&r.data.pageList.length>0?t.labelId=r.data.pageList[0].labelId:t.labelId=t.tagNum,t.appEnv.preview_model&&(t.coveImgData=null);case 9:case"end":return n.stop()}}),n,t)})))()}}},d=a(34);var m=function(e){a(120),a(121)},g=Object(d.a)(p,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"registerWrap",class:{zoomStyle:e.zoomStyle}},[a("div",{staticClass:"card_box"},[a("headBreadcrumb",{attrs:{title:"首页",tips:e.title,showbtn:!1,bistips:e.bisTitle,bisType:e.bisType},on:{goback:e.gotoBack,verifyFun:e.toggleBisType}}),e._v(" "),a("div",{staticClass:"contcentWrap",attrs:{"element-loading-text":e.loadingText,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.7)"}},[a("div",{staticClass:"concent"},[a("div",{staticClass:"videoWrap"},[a("div",{staticClass:"videoContent",class:{gradientWrapper:e.gradientWrapper,fadeAway:e.fadeAway}},[a("div",{staticClass:"scanBaseImgWrap",attrs:{id:"scanBaseImgWrap"}},[e.scan_base_img?a("div",{staticClass:"scanBaseImg",style:{backgroundImage:"url("+e.scan_base_img+")"}}):e._e()]),e._v(" "),e.scan_light_img?a("img",{staticClass:"scan",attrs:{id:"scanLight",src:e.scan_light_img}}):e._e(),e._v(" "),e.coveImgData?a("div",{style:{backgroundImage:"url("+e.coveImgData+")"},attrs:{id:"coveImg"}}):e._e(),e._v(" "),e.optionsWrapShow?a("div",{staticClass:"optionsWrap"},[a("div",{staticClass:"line"},[a("div",{staticClass:"label"},[e._v("曝光：")]),e._v(" "),a("el-slider",{staticClass:"slider",attrs:{min:-13,max:0,step:1},on:{change:function(t){e.setCameraOption("exposure",[t])}},model:{value:e.options.exposure,callback:function(t){e.$set(e.options,"exposure",t)},expression:"options.exposure"}}),e._v(" "),a("span",{staticClass:"sliderRightText"},[e._v(e._s(e.options.exposure))])],1),e._v(" "),a("div",{staticClass:"line"},[a("div",{staticClass:"label"},[e._v("自动曝光")]),e._v(" "),a("el-slider",{staticClass:"slider",attrs:{min:0,max:1,step:1},on:{change:function(t){e.setCameraOption("exposure_auto",[t])}},model:{value:e.options.exposure_auto,callback:function(t){e.$set(e.options,"exposure_auto",t)},expression:"options.exposure_auto"}}),e._v(" "),a("span",{staticClass:"sliderRightText"},[e._v(e._s(e.options.exposure_auto))])],1),e._v(" "),a("div",{staticClass:"line"},[a("div",{staticClass:"label"},[e._v("白平衡")]),e._v(" "),a("el-slider",{staticClass:"slider",attrs:{min:2700,max:6500,step:100},on:{change:function(t){e.setCameraOption("whitebalance",[t])}},model:{value:e.options.whitebalance,callback:function(t){e.$set(e.options,"whitebalance",t)},expression:"options.whitebalance"}}),e._v(" "),a("span",{staticClass:"sliderRightText"},[e._v(e._s(e.options.whitebalance))])],1),e._v(" "),a("div",{staticClass:"line"},[a("div",{staticClass:"label"},[e._v("自动白平衡")]),e._v(" "),a("el-slider",{staticClass:"slider",attrs:{min:0,max:1,step:1},on:{change:function(t){e.setCameraOption("whitebalance_auto",[t])}},model:{value:e.options.whitebalance_auto,callback:function(t){e.$set(e.options,"whitebalance_auto",t)},expression:"options.whitebalance_auto"}}),e._v(" "),a("span",{staticClass:"sliderRightText"},[e._v(e._s(e.options.whitebalance_auto))])],1),e._v(" "),a("div",{staticClass:"bottomBar"},[a("div",{staticClass:"reset",on:{click:function(t){return e.reset()}}},[e._v("重置")]),e._v(" "),a("div",{staticClass:"getList",on:{click:function(t){return e.closeOptionsContent()}}},[e._v("确认")])])]):e._e()])]),e._v(" "),a("div",{staticClass:"formArea"},[a("namedcomp",{attrs:{compName:e.sourceTypeName+"号"}},[a("div",{attrs:{slot:"component"},slot:"component"},[a("el-input",{staticClass:"formAreaInpurt",attrs:{clearable:"",maxlength:"50",disabled:!e.haveCamera,placeholder:"请输入"+e.sourceTypeName+"号（必填）"},on:{input:function(t){return e.handleInput(t)}},model:{value:e.tagName,callback:function(t){e.tagName="string"==typeof t?t.trim():t},expression:"tagName"}})],1)])],1),e._v(" "),a("div",{staticClass:"bisBottomBar"},[a("div",{staticClass:"bisButton",class:{active:e.active},attrs:{disabled:!e.active},on:{click:function(t){return e.register()}}},[e._v("注册")])])])])],1)])}),[],!1,m,"data-v-8a1f4c58",null);t.default=g.exports}}]);